--data_dir=/data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_data/ --model_dir=/data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_model_mtl_pairwiseem_nodecay_nopointcorr_extractips/ --output_dir=/data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_output/ --setting_file=./example/offline_setting/pairwise_regression_EM_mtl_nopointcorr_nodecay_extractips_exp_settings.json
WARNING:tensorflow:From main.py:344: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

WARNING:tensorflow:From main.py:107: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

W0709 15:12:09.532535 139810676172608 module_wrapper.py:139] From main.py:107: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

WARNING:tensorflow:From main.py:109: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

W0709 15:12:09.534507 139810676172608 module_wrapper.py:139] From main.py:109: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2021-07-09 15:12:09.560095: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA
2021-07-09 15:12:09.663490: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2494140000 Hz
2021-07-09 15:12:09.666379: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x42e71f0 initialized for platform Host (this does not guarantee that XLA will be used). Devices:
2021-07-09 15:12:09.666450: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (0): Host, Default Version
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:100: The name tf.summary.scalar is deprecated. Please use tf.compat.v1.summary.scalar instead.

W0709 15:12:09.716856 139810676172608 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:100: The name tf.summary.scalar is deprecated. Please use tf.compat.v1.summary.scalar instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:115: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0709 15:12:09.718903 139810676172608 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:115: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:117: Print (from tensorflow.python.ops.logging_ops) is deprecated and will be removed after 2018-08-20.
Instructions for updating:
Use tf.print instead of tf.Print. Note that tf.print returns a no-output operator that directly prints the output. Outside of defuns or eager mode, this operator will not be executed unless it is directly specified in session.run or used as a control dependency for other operators. This is only a concern in graph mode. Below is an example of how to ensure tf.print executes in graph mode:

W0709 15:12:09.720063 139810676172608 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:117: Print (from tensorflow.python.ops.logging_ops) is deprecated and will be removed after 2018-08-20.
Instructions for updating:
Use tf.print instead of tf.Print. Note that tf.print returns a no-output operator that directly prints the output. Outside of defuns or eager mode, this operator will not be executed unless it is directly specified in session.run or used as a control dependency for other operators. This is only a concern in graph mode. Below is an example of how to ensure tf.print executes in graph mode:

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:124: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0709 15:12:13.575028 139810676172608 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:124: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/DNN.py:61: The name tf.get_variable_scope is deprecated. Please use tf.compat.v1.get_variable_scope instead.

W0709 15:12:15.843385 139810676172608 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/DNN.py:61: The name tf.get_variable_scope is deprecated. Please use tf.compat.v1.get_variable_scope instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/DNN.py:62: The name tf.AUTO_REUSE is deprecated. Please use tf.compat.v1.AUTO_REUSE instead.

W0709 15:12:15.843769 139810676172608 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/DNN.py:62: The name tf.AUTO_REUSE is deprecated. Please use tf.compat.v1.AUTO_REUSE instead.

WARNING:tensorflow:From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/ops/resource_variable_ops.py:1630: calling BaseResourceVariable.__init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
W0709 15:12:15.955274 139810676172608 deprecation.py:506] From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/ops/resource_variable_ops.py:1630: calling BaseResourceVariable.__init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/base_ranking_model.py:121: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0709 15:12:15.971260 139810676172608 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/base_ranking_model.py:121: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:85: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0709 15:12:18.836700 139810676172608 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:85: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:278: to_float (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0709 15:12:24.389501 139810676172608 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:278: to_float (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:172: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0709 15:12:25.072353 139810676172608 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:172: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:173: The name tf.summary.histogram is deprecated. Please use tf.compat.v1.summary.histogram instead.

W0709 15:12:26.785419 139810676172608 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:173: The name tf.summary.histogram is deprecated. Please use tf.compat.v1.summary.histogram instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:491: calling reduce_sum_v1 (from tensorflow.python.ops.math_ops) with keep_dims is deprecated and will be removed in a future version.
Instructions for updating:
keep_dims is deprecated, use keepdims instead
W0709 15:12:26.845133 139810676172608 deprecation.py:506] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:491: calling reduce_sum_v1 (from tensorflow.python.ops.math_ops) with keep_dims is deprecated and will be removed in a future version.
Instructions for updating:
keep_dims is deprecated, use keepdims instead
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:48: The name tf.ceil is deprecated. Please use tf.math.ceil instead.

W0709 15:12:26.877207 139810676172608 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:48: The name tf.ceil is deprecated. Please use tf.math.ceil instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:48: The name tf.random_uniform is deprecated. Please use tf.random.uniform instead.

W0709 15:12:26.877421 139810676172608 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:48: The name tf.random_uniform is deprecated. Please use tf.random.uniform instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:208: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0709 15:12:27.114261 139810676172608 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:208: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:216: The name tf.train.AdagradOptimizer is deprecated. Please use tf.compat.v1.train.AdagradOptimizer instead.

W0709 15:12:27.115844 139810676172608 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:216: The name tf.train.AdagradOptimizer is deprecated. Please use tf.compat.v1.train.AdagradOptimizer instead.

WARNING:tensorflow:From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/training/adagrad.py:76: calling Constant.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0709 15:12:28.737765 139810676172608 deprecation.py:506] From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/training/adagrad.py:76: calling Constant.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:266: The name tf.summary.merge_all is deprecated. Please use tf.compat.v1.summary.merge_all instead.

W0709 15:12:29.736486 139810676172608 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:266: The name tf.summary.merge_all is deprecated. Please use tf.compat.v1.summary.merge_all instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:268: The name tf.train.Saver is deprecated. Please use tf.compat.v1.train.Saver instead.

W0709 15:12:29.748126 139810676172608 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:268: The name tf.train.Saver is deprecated. Please use tf.compat.v1.train.Saver instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:268: The name tf.global_variables is deprecated. Please use tf.compat.v1.global_variables instead.

W0709 15:12:29.748345 139810676172608 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:268: The name tf.global_variables is deprecated. Please use tf.compat.v1.global_variables instead.

INFO:tensorflow:Restoring parameters from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_model_mtl_pairwiseem_nodecay_nopointcorr_extractips/ultra.learning_algorithm.PairwiseRegressionEM.ckpt-900
I0709 15:12:29.897624 139810676172608 saver.py:1284] Restoring parameters from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_model_mtl_pairwiseem_nodecay_nopointcorr_extractips/ultra.learning_algorithm.PairwiseRegressionEM.ckpt-900
WARNING:tensorflow:From main.py:123: The name tf.summary.FileWriter is deprecated. Please use tf.compat.v1.summary.FileWriter instead.

W0709 15:12:31.547906 139810676172608 module_wrapper.py:139] From main.py:123: The name tf.summary.FileWriter is deprecated. Please use tf.compat.v1.summary.FileWriter instead.

loss_weight:[1]
loss_weight:[1]
loss_weight:[1]
loss_weight:[1]
loss_weight:[1]
loss_weight:[1]
loss_weight:[1]
loss_weight:[1]
loss_weight:[1]
loss_weight:[1]
2021-07-09 15:13:10.126742: W tensorflow/core/framework/cpu_allocator_impl.cc:81] Allocation of 476053504 exceeds 10% of system memory.
2021-07-09 15:13:10.536380: W tensorflow/core/framework/cpu_allocator_impl.cc:81] Allocation of 476053504 exceeds 10% of system memory.
2021-07-09 15:13:10.669752: W tensorflow/core/framework/cpu_allocator_impl.cc:81] Allocation of 476053504 exceeds 10% of system memory.
2021-07-09 15:13:10.733038: W tensorflow/core/framework/cpu_allocator_impl.cc:81] Allocation of 476053504 exceeds 10% of system memory.
2021-07-09 15:13:10.930225: W tensorflow/core/framework/cpu_allocator_impl.cc:81] Allocation of 238026752 exceeds 10% of system memory.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/data_utils.py:367: The name tf.Summary is deprecated. Please use tf.compat.v1.Summary instead.

W0709 15:13:33.271302 139810676172608 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/data_utils.py:367: The name tf.Summary is deprecated. Please use tf.compat.v1.Summary instead.

Reading data in /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_data/
Read data from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_data//train in ULTRA format.
Feature reading finish.
List reading finish.
Label reading finish.
Remove 183 invalid queries.
Data reading finish!
Finished reading 5817 queries with lists.
Read data from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_data//valid in ULTRA format.
Feature reading finish.
List reading finish.
Label reading finish.
Remove 0 invalid queries.
Data reading finish!
Finished reading 1939 queries with lists.
Train Rank list size 809
Valid Rank list size 908
Users can only see the top 10 documents for each query in training.
Creating model...
Build Pairwise RegressionEM algorithm.
corr_pair_clk_noise=True,enable_ips=True,exact_ips=True,opt_metric=None
in pairwise regem.. hparams: [('EM_step_size', 0.05), ('clk_noise_EM_ratio', 1.0), ('corr_pair_clk_noise', True), ('corr_point_clk_noise', False), ('discount_fn', 'log1p'), ('enable_ips', True), ('exact_ips', True), ('gain_fn', 'exp'), ('grad_strategy', 'ada'), ('l2_loss', 0.0), ('learning_rate', 0.05), ('max_gradient_norm', 5.0), ('opt_metric', 'None'), ('pointwise_only', False), ('reg_em_type', 0), ('step_decay_ratio', -0.0)]
None
ranking_model: <class 'ultra.ranking_model.DNN.DNN'>
kwargs: {'rank_list_size': 908, 'forward_only': False}
layer_norm objs for ips_ranking_model is:
[<tensorflow.python.keras.layers.normalization.LayerNormalization object at 0x7f2718056198>, <tensorflow.python.keras.layers.normalization.LayerNormalization object at 0x7f2700377fd0>, <tensorflow.python.keras.layers.normalization.LayerNormalization object at 0x7f270032ac88>, <tensorflow.python.keras.layers.normalization.LayerNormalization object at 0x7f270032aeb8>]
kwargs: {'rank_list_size': 10, 'forward_only': False}
layer_norm objs for point_ranking_model is:
[<tensorflow.python.keras.layers.normalization.LayerNormalization object at 0x7f26a7558748>, <tensorflow.python.keras.layers.normalization.LayerNormalization object at 0x7f26a7567eb8>, <tensorflow.python.keras.layers.normalization.LayerNormalization object at 0x7f26a756e5c0>, <tensorflow.python.keras.layers.normalization.LayerNormalization object at 0x7f26a756e828>]
kwargs: {'rank_list_size': 10, 'forward_only': False}
layer_norm objs for ranking_model is:
[<tensorflow.python.keras.layers.normalization.LayerNormalization object at 0x7f26a74f0ba8>, <tensorflow.python.keras.layers.normalization.LayerNormalization object at 0x7f26a74fc828>, <tensorflow.python.keras.layers.normalization.LayerNormalization object at 0x7f26a74fcef0>, <tensorflow.python.keras.layers.normalization.LayerNormalization object at 0x7f26a7483198>]
kwargs: {'rank_list_size': 10, 'forward_only': False}
layer_norm objs for ips_ranking_model is:
[<tensorflow.python.keras.layers.normalization.LayerNormalization object at 0x7f2718056198>, <tensorflow.python.keras.layers.normalization.LayerNormalization object at 0x7f2700377fd0>, <tensorflow.python.keras.layers.normalization.LayerNormalization object at 0x7f270032ac88>, <tensorflow.python.keras.layers.normalization.LayerNormalization object at 0x7f270032aeb8>]
trainable vars:
[<tf.Variable 'ips_ranking_model/ips_ranking_model/layer_norm_0/gamma:0' shape=(136,) dtype=float32>, <tf.Variable 'ips_ranking_model/ips_ranking_model/layer_norm_0/beta:0' shape=(136,) dtype=float32>, <tf.Variable 'ips_ranking_model/dnn_W_0:0' shape=(136, 512) dtype=float32_ref>, <tf.Variable 'ips_ranking_model/dnn_b_0:0' shape=(512,) dtype=float32_ref>, <tf.Variable 'ips_ranking_model/ips_ranking_model/layer_norm_1/gamma:0' shape=(512,) dtype=float32>, <tf.Variable 'ips_ranking_model/ips_ranking_model/layer_norm_1/beta:0' shape=(512,) dtype=float32>, <tf.Variable 'ips_ranking_model/dnn_W_1:0' shape=(512, 256) dtype=float32_ref>, <tf.Variable 'ips_ranking_model/dnn_b_1:0' shape=(256,) dtype=float32_ref>, <tf.Variable 'ips_ranking_model/ips_ranking_model/layer_norm_2/gamma:0' shape=(256,) dtype=float32>, <tf.Variable 'ips_ranking_model/ips_ranking_model/layer_norm_2/beta:0' shape=(256,) dtype=float32>, <tf.Variable 'ips_ranking_model/dnn_W_2:0' shape=(256, 128) dtype=float32_ref>, <tf.Variable 'ips_ranking_model/dnn_b_2:0' shape=(128,) dtype=float32_ref>, <tf.Variable 'ips_ranking_model/ips_ranking_model/layer_norm_3/gamma:0' shape=(128,) dtype=float32>, <tf.Variable 'ips_ranking_model/ips_ranking_model/layer_norm_3/beta:0' shape=(128,) dtype=float32>, <tf.Variable 'ips_ranking_model/dnn_W_3:0' shape=(128, 1) dtype=float32_ref>, <tf.Variable 'ips_ranking_model/dnn_b_3:0' shape=(1,) dtype=float32_ref>, <tf.Variable 'sigmoid_prob_b:0' shape=(1,) dtype=float32_ref>, <tf.Variable 'point_ranking_model/point_ranking_model/layer_norm_0/gamma:0' shape=(136,) dtype=float32>, <tf.Variable 'point_ranking_model/point_ranking_model/layer_norm_0/beta:0' shape=(136,) dtype=float32>, <tf.Variable 'point_ranking_model/dnn_W_0:0' shape=(136, 512) dtype=float32_ref>, <tf.Variable 'point_ranking_model/dnn_b_0:0' shape=(512,) dtype=float32_ref>, <tf.Variable 'point_ranking_model/point_ranking_model/layer_norm_1/gamma:0' shape=(512,) dtype=float32>, <tf.Variable 'point_ranking_model/point_ranking_model/layer_norm_1/beta:0' shape=(512,) dtype=float32>, <tf.Variable 'point_ranking_model/dnn_W_1:0' shape=(512, 256) dtype=float32_ref>, <tf.Variable 'point_ranking_model/dnn_b_1:0' shape=(256,) dtype=float32_ref>, <tf.Variable 'point_ranking_model/point_ranking_model/layer_norm_2/gamma:0' shape=(256,) dtype=float32>, <tf.Variable 'point_ranking_model/point_ranking_model/layer_norm_2/beta:0' shape=(256,) dtype=float32>, <tf.Variable 'point_ranking_model/dnn_W_2:0' shape=(256, 128) dtype=float32_ref>, <tf.Variable 'point_ranking_model/dnn_b_2:0' shape=(128,) dtype=float32_ref>, <tf.Variable 'point_ranking_model/point_ranking_model/layer_norm_3/gamma:0' shape=(128,) dtype=float32>, <tf.Variable 'point_ranking_model/point_ranking_model/layer_norm_3/beta:0' shape=(128,) dtype=float32>, <tf.Variable 'point_ranking_model/dnn_W_3:0' shape=(128, 1) dtype=float32_ref>, <tf.Variable 'point_ranking_model/dnn_b_3:0' shape=(1,) dtype=float32_ref>, <tf.Variable 'ranking_model/ranking_model/layer_norm_0/gamma:0' shape=(136,) dtype=float32>, <tf.Variable 'ranking_model/ranking_model/layer_norm_0/beta:0' shape=(136,) dtype=float32>, <tf.Variable 'ranking_model/dnn_W_0:0' shape=(136, 512) dtype=float32_ref>, <tf.Variable 'ranking_model/dnn_b_0:0' shape=(512,) dtype=float32_ref>, <tf.Variable 'ranking_model/ranking_model/layer_norm_1/gamma:0' shape=(512,) dtype=float32>, <tf.Variable 'ranking_model/ranking_model/layer_norm_1/beta:0' shape=(512,) dtype=float32>, <tf.Variable 'ranking_model/dnn_W_1:0' shape=(512, 256) dtype=float32_ref>, <tf.Variable 'ranking_model/dnn_b_1:0' shape=(256,) dtype=float32_ref>, <tf.Variable 'ranking_model/ranking_model/layer_norm_2/gamma:0' shape=(256,) dtype=float32>, <tf.Variable 'ranking_model/ranking_model/layer_norm_2/beta:0' shape=(256,) dtype=float32>, <tf.Variable 'ranking_model/dnn_W_2:0' shape=(256, 128) dtype=float32_ref>, <tf.Variable 'ranking_model/dnn_b_2:0' shape=(128,) dtype=float32_ref>, <tf.Variable 'ranking_model/ranking_model/layer_norm_3/gamma:0' shape=(128,) dtype=float32>, <tf.Variable 'ranking_model/ranking_model/layer_norm_3/beta:0' shape=(128,) dtype=float32>, <tf.Variable 'ranking_model/dnn_W_3:0' shape=(128, 1) dtype=float32_ref>, <tf.Variable 'ranking_model/dnn_b_3:0' shape=(1,) dtype=float32_ref>]
Reading model parameters from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_model_mtl_pairwiseem_nodecay_nopointcorr_extractips/ultra.learning_algorithm.PairwiseRegressionEM.ckpt-900
Create simluated clicks feed

Create direct label feed with list size 908 with feature size 136
global step 950 learning rate 0.0500 step-time 0.43 loss 22.2702
  valid: mrr_3:0.788 mrr_5:0.788 mrr_10:0.788 ndcg_3:0.342 ndcg_5:0.355 ndcg_10:0.383
Save model, valid ndcg_10:0.383
global step 1000 learning rate 0.0500 step-time 0.35 loss 22.3648
  valid: mrr_3:0.798 mrr_5:0.798 mrr_10:0.798 ndcg_3:0.360 ndcg_5:0.373 ndcg_10:0.397
Save model, valid ndcg_10:0.397
global step 1050 learning rate 0.0500 step-time 0.35 loss 22.5317
  valid: mrr_3:0.806 mrr_5:0.806 mrr_10:0.806 ndcg_3:0.359 ndcg_5:0.368 ndcg_10:0.394
global step 1100 learning rate 0.0500 step-time 0.37 loss 22.6816
  valid: mrr_3:0.758 mrr_5:0.758 mrr_10:0.758 ndcg_3:0.336 ndcg_5:0.344 ndcg_10:0.370
global step 1150 learning rate 0.0500 step-time 0.34 loss 22.7754
  valid: mrr_3:0.799 mrr_5:0.799 mrr_10:0.799 ndcg_3:0.359 ndcg_5:0.367 ndcg_10:0.392
global step 1200 learning rate 0.0500 step-time 0.39 loss 22.7228
  valid: mrr_3:0.821 mrr_5:0.821 mrr_10:0.821 ndcg_3:0.375 ndcg_5:0.384 ndcg_10:0.407
Save model, valid ndcg_10:0.407
global step 1250 learning rate 0.0500 step-time 0.34 loss 22.9502
  valid: mrr_3:0.806 mrr_5:0.806 mrr_10:0.806 ndcg_3:0.367 ndcg_5:0.377 ndcg_10:0.398
global step 1300 learning rate 0.0500 step-time 0.31 loss 22.9768
  valid: mrr_3:0.814 mrr_5:0.814 mrr_10:0.814 ndcg_3:0.375 ndcg_5:0.381 ndcg_10:0.404
global step 1350 learning rate 0.0500 step-time 0.37 loss 23.1471
  valid: mrr_3:0.814 mrr_5:0.814 mrr_10:0.814 ndcg_3:0.368 ndcg_5:0.378 ndcg_10:0.400
global step 1400 learning rate 0.0500 step-time 0.37 loss 23.2668
  valid: mrr_3:0.796 mrr_5:0.796 mrr_10:0.796 ndcg_3:0.359 ndcg_5:0.367 ndcg_10:0.390
global step 1450 learning rate 0.0500 step-time 0.37 loss 23.3364
  valid: mrr_3:0.795 mrr_5:0.795 mrr_10:0.795 ndcg_3:0.362 ndcg_5:0.370 ndcg_10:0.392
global step 1500 learning rate 0.0500 step-time 0.36 loss 23.4350
  valid: mrr_3:0.784 mrr_5:0.784 mrr_10:0.784 ndcg_3:0.359 ndcg_5:0.365 ndcg_10:0.387
global step 1550 learning rate 0.0500 step-time 0.31 loss 23.4242
  valid: mrr_3:0.793 mrr_5:0.793 mrr_10:0.793 ndcg_3:0.359 ndcg_5:0.370 ndcg_10:0.392
global step 1600 learning rate 0.0500 step-time 0.34 loss 23.6471
  valid: mrr_3:0.825 mrr_5:0.825 mrr_10:0.825 ndcg_3:0.380 ndcg_5:0.386 ndcg_10:0.410
Save model, valid ndcg_10:0.410
global step 1650 learning rate 0.0500 step-time 0.35 loss 23.7397
  valid: mrr_3:0.818 mrr_5:0.818 mrr_10:0.818 ndcg_3:0.377 ndcg_5:0.385 ndcg_10:0.408
global step 1700 learning rate 0.0500 step-time 0.36 loss 23.5932
  valid: mrr_3:0.775 mrr_5:0.775 mrr_10:0.775 ndcg_3:0.343 ndcg_5:0.350 ndcg_10:0.373
global step 1750 learning rate 0.0500 step-time 0.37 loss 23.6492
  valid: mrr_3:0.803 mrr_5:0.803 mrr_10:0.803 ndcg_3:0.367 ndcg_5:0.377 ndcg_10:0.400
global step 1800 learning rate 0.0500 step-time 0.33 loss 23.7214
  valid: mrr_3:0.806 mrr_5:0.806 mrr_10:0.806 ndcg_3:0.364 ndcg_5:0.371 ndcg_10:0.395
global step 1850 learning rate 0.0500 step-time 0.58 loss 23.7592
  valid: mrr_3:0.804 mrr_5:0.804 mrr_10:0.804 ndcg_3:0.365 ndcg_5:0.373 ndcg_10:0.398
2021-07-09 15:27:43.435836: W tensorflow/core/framework/op_kernel.cc:1651] OP_REQUIRES failed at cwise_ops_common.cc:82 : Resource exhausted: OOM when allocating tensor with shape[232448,512] and type float on /job:localhost/replica:0/task:0/device:CPU:0 by allocator cpu
Fatal Python error: Segmentation fault

Thread 0x00007f26a503b700 (most recent call first):
  File "/usr/lib64/python3.6/threading.py", line 295 in wait
  File "/usr/lib64/python3.6/queue.py", line 164 in get
  File "/usr/local/lib64/python3.6/site-packages/tensorflow_core/python/summary/writer/event_file_writer.py", line 159 in run
  File "/usr/lib64/python3.6/threading.py", line 916 in _bootstrap_inner
  File "/usr/lib64/python3.6/threading.py", line 884 in _bootstrap

Thread 0x00007f26827fc700 (most recent call first):
  File "/usr/lib64/python3.6/threading.py", line 295 in wait
  File "/usr/lib64/python3.6/queue.py", line 164 in get
  File "/usr/local/lib64/python3.6/site-packages/tensorflow_core/python/summary/writer/event_file_writer.py", line 159 in run
  File "/usr/lib64/python3.6/threading.py", line 916 in _bootstrap_inner
  File "/usr/lib64/python3.6/threading.py", line 884 in _bootstrap

Thread 0x00007f2835b06740 (most recent call first):
  File "/usr/local/lib64/python3.6/site-packages/tensorflow_core/python/client/session.py", line 1443 in _call_tf_sessionrun
  File "/usr/local/lib64/python3.6/site-packages/tensorflow_core/python/client/session.py", line 1350 in _run_fn
  File "/usr/local/lib64/python3.6/site-packages/tensorflow_core/python/client/session.py", line 1365 in _do_call
  File "/usr/local/lib64/python3.6/site-packages/tensorflow_core/python/client/session.py", line 1359 in _do_run
  File "/usr/local/lib64/python3.6/site-packages/tensorflow_core/python/client/session.py", line 1180 in _run
  File "/usr/local/lib64/python3.6/site-packages/tensorflow_core/python/client/session.py", line 956 in run
  File "/data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py", line 685 in step
  File "main.py", line 160 in validate_model
  File "main.py", line 167 in train
  File "main.py", line 341 in main
  File "/usr/local/lib/python3.6/site-packages/absl/app.py", line 251 in _run_main
  File "/usr/local/lib/python3.6/site-packages/absl/app.py", line 303 in run
  File "/usr/local/lib64/python3.6/site-packages/tensorflow_core/python/platform/app.py", line 40 in run
  File "main.py", line 344 in <module>
offline_exp_pipeline_mtl_pairwiseem_nodecay_nopointcorr_extractips.sh: line 82: 21593 Segmentation fault      python3 main.py --max_train_iteration=2000 $SETTING_ARGS
WARNING:tensorflow:From main.py:344: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

WARNING:tensorflow:From main.py:279: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

W0709 15:27:56.212061 140366975190848 module_wrapper.py:139] From main.py:279: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

WARNING:tensorflow:From main.py:281: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

W0709 15:27:56.212528 140366975190848 module_wrapper.py:139] From main.py:281: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2021-07-09 15:27:56.217692: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA
2021-07-09 15:27:56.253868: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2494140000 Hz
2021-07-09 15:27:56.254579: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x4151bd0 initialized for platform Host (this does not guarantee that XLA will be used). Devices:
2021-07-09 15:27:56.254620: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (0): Host, Default Version
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:100: The name tf.summary.scalar is deprecated. Please use tf.compat.v1.summary.scalar instead.

W0709 15:29:10.459443 140366975190848 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:100: The name tf.summary.scalar is deprecated. Please use tf.compat.v1.summary.scalar instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:115: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0709 15:29:10.463401 140366975190848 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:115: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:117: Print (from tensorflow.python.ops.logging_ops) is deprecated and will be removed after 2018-08-20.
Instructions for updating:
Use tf.print instead of tf.Print. Note that tf.print returns a no-output operator that directly prints the output. Outside of defuns or eager mode, this operator will not be executed unless it is directly specified in session.run or used as a control dependency for other operators. This is only a concern in graph mode. Below is an example of how to ensure tf.print executes in graph mode:

W0709 15:29:10.464622 140366975190848 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:117: Print (from tensorflow.python.ops.logging_ops) is deprecated and will be removed after 2018-08-20.
Instructions for updating:
Use tf.print instead of tf.Print. Note that tf.print returns a no-output operator that directly prints the output. Outside of defuns or eager mode, this operator will not be executed unless it is directly specified in session.run or used as a control dependency for other operators. This is only a concern in graph mode. Below is an example of how to ensure tf.print executes in graph mode:

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:124: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0709 15:29:11.155430 140366975190848 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:124: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/DNN.py:61: The name tf.get_variable_scope is deprecated. Please use tf.compat.v1.get_variable_scope instead.

W0709 15:29:12.624376 140366975190848 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/DNN.py:61: The name tf.get_variable_scope is deprecated. Please use tf.compat.v1.get_variable_scope instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/DNN.py:62: The name tf.AUTO_REUSE is deprecated. Please use tf.compat.v1.AUTO_REUSE instead.

W0709 15:29:12.624879 140366975190848 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/DNN.py:62: The name tf.AUTO_REUSE is deprecated. Please use tf.compat.v1.AUTO_REUSE instead.

WARNING:tensorflow:From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/ops/resource_variable_ops.py:1630: calling BaseResourceVariable.__init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
W0709 15:29:12.716576 140366975190848 deprecation.py:506] From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/ops/resource_variable_ops.py:1630: calling BaseResourceVariable.__init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/base_ranking_model.py:121: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0709 15:29:12.781978 140366975190848 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/base_ranking_model.py:121: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:85: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0709 15:29:14.879740 140366975190848 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:85: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:278: to_float (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0709 15:29:17.309978 140366975190848 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:278: to_float (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:172: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0709 15:29:17.814033 140366975190848 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:172: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:266: The name tf.summary.merge_all is deprecated. Please use tf.compat.v1.summary.merge_all instead.

W0709 15:29:18.199323 140366975190848 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:266: The name tf.summary.merge_all is deprecated. Please use tf.compat.v1.summary.merge_all instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:268: The name tf.train.Saver is deprecated. Please use tf.compat.v1.train.Saver instead.

W0709 15:29:18.200873 140366975190848 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:268: The name tf.train.Saver is deprecated. Please use tf.compat.v1.train.Saver instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:268: The name tf.global_variables is deprecated. Please use tf.compat.v1.global_variables instead.

W0709 15:29:18.201064 140366975190848 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:268: The name tf.global_variables is deprecated. Please use tf.compat.v1.global_variables instead.

INFO:tensorflow:Restoring parameters from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_model_mtl_pairwiseem_nodecay_nopointcorr_extractips/ultra.learning_algorithm.PairwiseRegressionEM.ckpt-1600
I0709 15:29:18.249057 140366975190848 saver.py:1284] Restoring parameters from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_model_mtl_pairwiseem_nodecay_nopointcorr_extractips/ultra.learning_algorithm.PairwiseRegressionEM.ckpt-1600
WARNING:tensorflow:From main.py:296: The name tf.summary.FileWriter is deprecated. Please use tf.compat.v1.summary.FileWriter instead.

W0709 15:29:18.840759 140366975190848 module_wrapper.py:139] From main.py:296: The name tf.summary.FileWriter is deprecated. Please use tf.compat.v1.summary.FileWriter instead.

Reading data in /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_data/
Read data from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_data//test in ULTRA format.
Feature reading finish.
List reading finish.
Label reading finish.
Remove 1 invalid queries.
Data reading finish!
Finished reading 1927 queries with lists.
Build Pairwise RegressionEM algorithm.
corr_pair_clk_noise=True,enable_ips=True,exact_ips=True,opt_metric=None
in pairwise regem.. hparams: [('EM_step_size', 0.05), ('clk_noise_EM_ratio', 1.0), ('corr_pair_clk_noise', True), ('corr_point_clk_noise', False), ('discount_fn', 'log1p'), ('enable_ips', True), ('exact_ips', True), ('gain_fn', 'exp'), ('grad_strategy', 'ada'), ('l2_loss', 0.0), ('learning_rate', 0.05), ('max_gradient_norm', 5.0), ('opt_metric', 'None'), ('pointwise_only', False), ('reg_em_type', 0), ('step_decay_ratio', -0.0)]
None
ranking_model: <class 'ultra.ranking_model.DNN.DNN'>
kwargs: {'rank_list_size': 514, 'forward_only': False}
layer_norm objs for ips_ranking_model is:
[<tensorflow.python.keras.layers.normalization.LayerNormalization object at 0x7fa8ba124710>, <tensorflow.python.keras.layers.normalization.LayerNormalization object at 0x7fa8b9e190b8>, <tensorflow.python.keras.layers.normalization.LayerNormalization object at 0x7fa8b9e35860>, <tensorflow.python.keras.layers.normalization.LayerNormalization object at 0x7fa8b9e35a90>]
Reading model parameters from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_model_mtl_pairwiseem_nodecay_nopointcorr_extractips/ultra.learning_algorithm.PairwiseRegressionEM.ckpt-1600
Create direct label feed with list size 514 with feature size 136
Testing 13% finishedTesting 27% finishedTesting 40% finishedTesting 53% finishedTesting 66% finishedTesting 80% finishedTesting 93% finishedTesting 100% finishedWARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/data_utils.py:367: The name tf.Summary is deprecated. Please use tf.compat.v1.Summary instead.

W0709 15:29:37.551074 140366975190848 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/data_utils.py:367: The name tf.Summary is deprecated. Please use tf.compat.v1.Summary instead.


[Done]
  eval: mrr_3:0.817 mrr_5:0.817 mrr_10:0.817 ndcg_3:0.375 ndcg_5:0.382 ndcg_10:0.406
