--data_dir=/data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_data/ --model_dir=/data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_model_mtl_pointwiseem_nodecay_nocorr/ --output_dir=/data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_output/ --setting_file=./example/offline_setting/pointwise_regression_EM_mtl_nocorr_nodecay_exp_settings.json
WARNING:tensorflow:From main.py:344: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

WARNING:tensorflow:From main.py:107: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

W0707 15:45:54.785687 140438010206016 module_wrapper.py:139] From main.py:107: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

WARNING:tensorflow:From main.py:109: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

W0707 15:45:54.786022 140438010206016 module_wrapper.py:139] From main.py:109: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2021-07-07 15:45:54.786622: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA
2021-07-07 15:45:54.793915: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2494140000 Hz
2021-07-07 15:45:54.794377: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x4bc9010 initialized for platform Host (this does not guarantee that XLA will be used). Devices:
2021-07-07 15:45:54.794402: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (0): Host, Default Version
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:99: The name tf.summary.scalar is deprecated. Please use tf.compat.v1.summary.scalar instead.

W0707 15:45:54.809699 140438010206016 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:99: The name tf.summary.scalar is deprecated. Please use tf.compat.v1.summary.scalar instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:114: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0707 15:45:54.811665 140438010206016 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:114: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:116: Print (from tensorflow.python.ops.logging_ops) is deprecated and will be removed after 2018-08-20.
Instructions for updating:
Use tf.print instead of tf.Print. Note that tf.print returns a no-output operator that directly prints the output. Outside of defuns or eager mode, this operator will not be executed unless it is directly specified in session.run or used as a control dependency for other operators. This is only a concern in graph mode. Below is an example of how to ensure tf.print executes in graph mode:

W0707 15:45:54.812771 140438010206016 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:116: Print (from tensorflow.python.ops.logging_ops) is deprecated and will be removed after 2018-08-20.
Instructions for updating:
Use tf.print instead of tf.Print. Note that tf.print returns a no-output operator that directly prints the output. Outside of defuns or eager mode, this operator will not be executed unless it is directly specified in session.run or used as a control dependency for other operators. This is only a concern in graph mode. Below is an example of how to ensure tf.print executes in graph mode:

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:124: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0707 15:45:57.624103 140438010206016 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:124: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/DNN.py:62: The name tf.get_variable_scope is deprecated. Please use tf.compat.v1.get_variable_scope instead.

W0707 15:45:59.619650 140438010206016 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/DNN.py:62: The name tf.get_variable_scope is deprecated. Please use tf.compat.v1.get_variable_scope instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/DNN.py:63: The name tf.AUTO_REUSE is deprecated. Please use tf.compat.v1.AUTO_REUSE instead.

W0707 15:45:59.620182 140438010206016 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/DNN.py:63: The name tf.AUTO_REUSE is deprecated. Please use tf.compat.v1.AUTO_REUSE instead.

WARNING:tensorflow:From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/ops/resource_variable_ops.py:1630: calling BaseResourceVariable.__init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
W0707 15:45:59.687436 140438010206016 deprecation.py:506] From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/ops/resource_variable_ops.py:1630: calling BaseResourceVariable.__init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/base_ranking_model.py:121: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0707 15:45:59.716679 140438010206016 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/base_ranking_model.py:121: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:85: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0707 15:46:02.403824 140438010206016 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:85: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:278: to_float (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0707 15:46:08.243906 140438010206016 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:278: to_float (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:172: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0707 15:46:08.838301 140438010206016 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:172: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:173: The name tf.summary.histogram is deprecated. Please use tf.compat.v1.summary.histogram instead.

W0707 15:46:11.272649 140438010206016 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:173: The name tf.summary.histogram is deprecated. Please use tf.compat.v1.summary.histogram instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:469: calling reduce_sum_v1 (from tensorflow.python.ops.math_ops) with keep_dims is deprecated and will be removed in a future version.
Instructions for updating:
keep_dims is deprecated, use keepdims instead
W0707 15:46:11.348576 140438010206016 deprecation.py:506] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:469: calling reduce_sum_v1 (from tensorflow.python.ops.math_ops) with keep_dims is deprecated and will be removed in a future version.
Instructions for updating:
keep_dims is deprecated, use keepdims instead
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:48: The name tf.ceil is deprecated. Please use tf.math.ceil instead.

W0707 15:46:11.393532 140438010206016 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:48: The name tf.ceil is deprecated. Please use tf.math.ceil instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:48: The name tf.random_uniform is deprecated. Please use tf.random.uniform instead.

W0707 15:46:11.393895 140438010206016 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:48: The name tf.random_uniform is deprecated. Please use tf.random.uniform instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:206: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0707 15:46:11.418472 140438010206016 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:206: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:212: The name tf.train.AdagradOptimizer is deprecated. Please use tf.compat.v1.train.AdagradOptimizer instead.

W0707 15:46:11.418902 140438010206016 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:212: The name tf.train.AdagradOptimizer is deprecated. Please use tf.compat.v1.train.AdagradOptimizer instead.

WARNING:tensorflow:From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/training/adagrad.py:76: calling Constant.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0707 15:46:12.126998 140438010206016 deprecation.py:506] From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/training/adagrad.py:76: calling Constant.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:262: The name tf.summary.merge_all is deprecated. Please use tf.compat.v1.summary.merge_all instead.

W0707 15:46:12.741453 140438010206016 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:262: The name tf.summary.merge_all is deprecated. Please use tf.compat.v1.summary.merge_all instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:264: The name tf.train.Saver is deprecated. Please use tf.compat.v1.train.Saver instead.

W0707 15:46:12.751087 140438010206016 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:264: The name tf.train.Saver is deprecated. Please use tf.compat.v1.train.Saver instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:264: The name tf.global_variables is deprecated. Please use tf.compat.v1.global_variables instead.

W0707 15:46:12.751323 140438010206016 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:264: The name tf.global_variables is deprecated. Please use tf.compat.v1.global_variables instead.

INFO:tensorflow:Restoring parameters from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_model_mtl_pointwiseem_nodecay_nocorr/ultra.learning_algorithm.PairwiseRegressionEM.ckpt-2000
I0707 15:46:12.808542 140438010206016 saver.py:1284] Restoring parameters from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_model_mtl_pointwiseem_nodecay_nocorr/ultra.learning_algorithm.PairwiseRegressionEM.ckpt-2000
WARNING:tensorflow:From main.py:123: The name tf.summary.FileWriter is deprecated. Please use tf.compat.v1.summary.FileWriter instead.

W0707 15:46:13.938386 140438010206016 module_wrapper.py:139] From main.py:123: The name tf.summary.FileWriter is deprecated. Please use tf.compat.v1.summary.FileWriter instead.

2021-07-07 15:46:47.634623: W tensorflow/core/framework/cpu_allocator_impl.cc:81] Allocation of 476053504 exceeds 10% of system memory.
2021-07-07 15:46:48.099555: W tensorflow/core/framework/cpu_allocator_impl.cc:81] Allocation of 476053504 exceeds 10% of system memory.
2021-07-07 15:46:48.242826: W tensorflow/core/framework/cpu_allocator_impl.cc:81] Allocation of 476053504 exceeds 10% of system memory.
2021-07-07 15:46:48.324282: W tensorflow/core/framework/cpu_allocator_impl.cc:81] Allocation of 476053504 exceeds 10% of system memory.
2021-07-07 15:46:50.519880: W tensorflow/core/framework/cpu_allocator_impl.cc:81] Allocation of 476053504 exceeds 10% of system memory.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/data_utils.py:367: The name tf.Summary is deprecated. Please use tf.compat.v1.Summary instead.

W0707 15:47:10.179376 140438010206016 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/data_utils.py:367: The name tf.Summary is deprecated. Please use tf.compat.v1.Summary instead.

Reading data in /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_data/
Read data from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_data//train in ULTRA format.
Feature reading finish.
List reading finish.
Label reading finish.
Remove 183 invalid queries.
Data reading finish!
Finished reading 5817 queries with lists.
Read data from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_data//valid in ULTRA format.
Feature reading finish.
List reading finish.
Label reading finish.
Remove 0 invalid queries.
Data reading finish!
Finished reading 1939 queries with lists.
Train Rank list size 809
Valid Rank list size 908
Users can only see the top 10 documents for each query in training.
Creating model...
Build Pairwise RegressionEM algorithm.
corr_point_clk_noise=False,step_decay_ratio=0,pointwise_only=True
in pairwise regem.. hparams: [('EM_step_size', 0.05), ('clk_noise_EM_ratio', 1.0), ('corr_pair_clk_noise', True), ('corr_point_clk_noise', False), ('discount_fn', 'log1p'), ('enable_ips', False), ('gain_fn', 'exp'), ('grad_strategy', 'ada'), ('l2_loss', 0.0), ('learning_rate', 0.05), ('max_gradient_norm', 5.0), ('opt_metric', 'ndcg'), ('pointwise_only', True), ('reg_em_type', 0), ('step_decay_ratio', 0.0)]
<ultra.utils.losses_impl.DCGLambdaWeight object at 0x7fb95ee8e940>
ranking_model: <class 'ultra.ranking_model.DNN.DNN'>
kwargs: {'rank_list_size': 908, 'forward_only': False}
kwargs: {'rank_list_size': 10, 'forward_only': False}
kwargs: {'rank_list_size': 10, 'forward_only': False}
kwargs: {'rank_list_size': 10, 'forward_only': False}
Reading model parameters from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_model_mtl_pointwiseem_nodecay_nocorr/ultra.learning_algorithm.PairwiseRegressionEM.ckpt-2000
Create simluated clicks feed

Create direct label feed with list size 908 with feature size 136
global step 2050 learning rate 0.0500 step-time 0.33 loss 5.9258
  valid: mrr_3:0.708 mrr_5:0.708 mrr_10:0.708 ndcg_3:0.273 ndcg_5:0.285 ndcg_10:0.314
Save model, valid ndcg_10:0.314
global step 2100 learning rate 0.0500 step-time 0.29 loss 5.9374
  valid: mrr_3:0.765 mrr_5:0.765 mrr_10:0.765 ndcg_3:0.324 ndcg_5:0.336 ndcg_10:0.361
Save model, valid ndcg_10:0.361
global step 2150 learning rate 0.0500 step-time 0.25 loss 5.9482
  valid: mrr_3:0.756 mrr_5:0.756 mrr_10:0.756 ndcg_3:0.321 ndcg_5:0.332 ndcg_10:0.361
global step 2200 learning rate 0.0500 step-time 0.29 loss 5.9114
  valid: mrr_3:0.743 mrr_5:0.743 mrr_10:0.743 ndcg_3:0.297 ndcg_5:0.304 ndcg_10:0.329
global step 2250 learning rate 0.0500 step-time 0.28 loss 5.8744
  valid: mrr_3:0.735 mrr_5:0.735 mrr_10:0.735 ndcg_3:0.305 ndcg_5:0.317 ndcg_10:0.344
global step 2300 learning rate 0.0500 step-time 0.29 loss 5.9267
  valid: mrr_3:0.705 mrr_5:0.705 mrr_10:0.705 ndcg_3:0.277 ndcg_5:0.289 ndcg_10:0.315
global step 2350 learning rate 0.0500 step-time 0.28 loss 5.9563
  valid: mrr_3:0.732 mrr_5:0.732 mrr_10:0.732 ndcg_3:0.306 ndcg_5:0.318 ndcg_10:0.348
global step 2400 learning rate 0.0500 step-time 0.26 loss 5.9182
  valid: mrr_3:0.728 mrr_5:0.728 mrr_10:0.728 ndcg_3:0.302 ndcg_5:0.314 ndcg_10:0.341
global step 2450 learning rate 0.0500 step-time 0.26 loss 5.9271
  valid: mrr_3:0.703 mrr_5:0.703 mrr_10:0.703 ndcg_3:0.284 ndcg_5:0.299 ndcg_10:0.327
global step 2500 learning rate 0.0500 step-time 0.26 loss 5.9667
  valid: mrr_3:0.725 mrr_5:0.725 mrr_10:0.725 ndcg_3:0.301 ndcg_5:0.315 ndcg_10:0.342
global step 2550 learning rate 0.0500 step-time 0.29 loss 5.9550
  valid: mrr_3:0.750 mrr_5:0.750 mrr_10:0.750 ndcg_3:0.319 ndcg_5:0.328 ndcg_10:0.357
global step 2600 learning rate 0.0500 step-time 0.28 loss 5.9557
  valid: mrr_3:0.688 mrr_5:0.688 mrr_10:0.688 ndcg_3:0.259 ndcg_5:0.274 ndcg_10:0.303
global step 2650 learning rate 0.0500 step-time 0.25 loss 5.8824
  valid: mrr_3:0.760 mrr_5:0.760 mrr_10:0.760 ndcg_3:0.324 ndcg_5:0.333 ndcg_10:0.362
Save model, valid ndcg_10:0.362
global step 2700 learning rate 0.0500 step-time 0.29 loss 5.9388
  valid: mrr_3:0.769 mrr_5:0.769 mrr_10:0.769 ndcg_3:0.328 ndcg_5:0.341 ndcg_10:0.365
Save model, valid ndcg_10:0.365
global step 2750 learning rate 0.0500 step-time 0.25 loss 5.9334
  valid: mrr_3:0.729 mrr_5:0.729 mrr_10:0.729 ndcg_3:0.301 ndcg_5:0.310 ndcg_10:0.336
global step 2800 learning rate 0.0500 step-time 0.28 loss 5.9557
  valid: mrr_3:0.715 mrr_5:0.715 mrr_10:0.715 ndcg_3:0.278 ndcg_5:0.293 ndcg_10:0.319
global step 2850 learning rate 0.0500 step-time 0.25 loss 5.9413
  valid: mrr_3:0.748 mrr_5:0.748 mrr_10:0.748 ndcg_3:0.314 ndcg_5:0.322 ndcg_10:0.352
global step 2900 learning rate 0.0500 step-time 0.28 loss 5.9235
  valid: mrr_3:0.730 mrr_5:0.730 mrr_10:0.730 ndcg_3:0.288 ndcg_5:0.300 ndcg_10:0.332
global step 2950 learning rate 0.0500 step-time 0.27 loss 5.9512
  valid: mrr_3:0.713 mrr_5:0.713 mrr_10:0.713 ndcg_3:0.295 ndcg_5:0.308 ndcg_10:0.337
global step 3000 learning rate 0.0500 step-time 0.29 loss 5.9775
  valid: mrr_3:0.728 mrr_5:0.728 mrr_10:0.728 ndcg_3:0.298 ndcg_5:0.311 ndcg_10:0.340
global step 3050 learning rate 0.0500 step-time 0.27 loss 5.9448
  valid: mrr_3:0.720 mrr_5:0.720 mrr_10:0.720 ndcg_3:0.291 ndcg_5:0.302 ndcg_10:0.330
global step 3100 learning rate 0.0500 step-time 0.25 loss 5.9360
  valid: mrr_3:0.736 mrr_5:0.736 mrr_10:0.736 ndcg_3:0.304 ndcg_5:0.314 ndcg_10:0.342
global step 3150 learning rate 0.0500 step-time 0.28 loss 5.9159
  valid: mrr_3:0.744 mrr_5:0.744 mrr_10:0.744 ndcg_3:0.311 ndcg_5:0.326 ndcg_10:0.352
global step 3200 learning rate 0.0500 step-time 0.24 loss 5.9141
  valid: mrr_3:0.711 mrr_5:0.711 mrr_10:0.711 ndcg_3:0.289 ndcg_5:0.300 ndcg_10:0.329
global step 3250 learning rate 0.0500 step-time 0.27 loss 5.9406
  valid: mrr_3:0.769 mrr_5:0.769 mrr_10:0.769 ndcg_3:0.335 ndcg_5:0.346 ndcg_10:0.371
Save model, valid ndcg_10:0.371
global step 3300 learning rate 0.0500 step-time 0.26 loss 5.9104
  valid: mrr_3:0.735 mrr_5:0.735 mrr_10:0.735 ndcg_3:0.307 ndcg_5:0.316 ndcg_10:0.343
WARNING:tensorflow:From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/training/saver.py:963: remove_checkpoint (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to delete files with this prefix.
W0707 16:03:56.136824 140438010206016 deprecation.py:323] From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/training/saver.py:963: remove_checkpoint (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to delete files with this prefix.
global step 3350 learning rate 0.0500 step-time 0.28 loss 5.9482
  valid: mrr_3:0.778 mrr_5:0.778 mrr_10:0.778 ndcg_3:0.340 ndcg_5:0.351 ndcg_10:0.374
Save model, valid ndcg_10:0.374
global step 3400 learning rate 0.0500 step-time 0.21 loss 5.9379
  valid: mrr_3:0.745 mrr_5:0.745 mrr_10:0.745 ndcg_3:0.309 ndcg_5:0.320 ndcg_10:0.349
global step 3450 learning rate 0.0500 step-time 0.21 loss 5.9202
  valid: mrr_3:0.763 mrr_5:0.763 mrr_10:0.763 ndcg_3:0.330 ndcg_5:0.343 ndcg_10:0.368
global step 3500 learning rate 0.0500 step-time 0.27 loss 5.9819
  valid: mrr_3:0.766 mrr_5:0.766 mrr_10:0.766 ndcg_3:0.323 ndcg_5:0.334 ndcg_10:0.356
global step 3550 learning rate 0.0500 step-time 0.19 loss 5.9700
  valid: mrr_3:0.738 mrr_5:0.738 mrr_10:0.738 ndcg_3:0.307 ndcg_5:0.317 ndcg_10:0.347
global step 3600 learning rate 0.0500 step-time 0.21 loss 6.0024
  valid: mrr_3:0.720 mrr_5:0.720 mrr_10:0.720 ndcg_3:0.296 ndcg_5:0.307 ndcg_10:0.336
global step 3650 learning rate 0.0500 step-time 0.19 loss 5.9681
  valid: mrr_3:0.712 mrr_5:0.712 mrr_10:0.712 ndcg_3:0.285 ndcg_5:0.297 ndcg_10:0.323
global step 3700 learning rate 0.0500 step-time 0.21 loss 6.0037
  valid: mrr_3:0.733 mrr_5:0.733 mrr_10:0.733 ndcg_3:0.305 ndcg_5:0.317 ndcg_10:0.345
global step 3750 learning rate 0.0500 step-time 0.20 loss 6.0245
  valid: mrr_3:0.730 mrr_5:0.730 mrr_10:0.730 ndcg_3:0.298 ndcg_5:0.313 ndcg_10:0.341
global step 3800 learning rate 0.0500 step-time 0.20 loss 5.9767
  valid: mrr_3:0.666 mrr_5:0.666 mrr_10:0.666 ndcg_3:0.258 ndcg_5:0.272 ndcg_10:0.302
global step 3850 learning rate 0.0500 step-time 0.21 loss 5.9855
  valid: mrr_3:0.689 mrr_5:0.689 mrr_10:0.689 ndcg_3:0.269 ndcg_5:0.283 ndcg_10:0.311
global step 3900 learning rate 0.0500 step-time 0.21 loss 5.9995
  valid: mrr_3:0.752 mrr_5:0.752 mrr_10:0.752 ndcg_3:0.318 ndcg_5:0.328 ndcg_10:0.356
global step 3950 learning rate 0.0500 step-time 0.21 loss 5.9663
  valid: mrr_3:0.739 mrr_5:0.739 mrr_10:0.739 ndcg_3:0.315 ndcg_5:0.326 ndcg_10:0.352
global step 4000 learning rate 0.0500 step-time 0.20 loss 5.9944
  valid: mrr_3:0.726 mrr_5:0.726 mrr_10:0.726 ndcg_3:0.293 ndcg_5:0.304 ndcg_10:0.330
global step 4050 learning rate 0.0500 step-time 0.20 loss 5.9868
  valid: mrr_3:0.739 mrr_5:0.739 mrr_10:0.739 ndcg_3:0.304 ndcg_5:0.318 ndcg_10:0.345
WARNING:tensorflow:From main.py:344: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

WARNING:tensorflow:From main.py:279: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

W0707 16:11:07.227610 139897005205312 module_wrapper.py:139] From main.py:279: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

WARNING:tensorflow:From main.py:281: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

W0707 16:11:07.227873 139897005205312 module_wrapper.py:139] From main.py:281: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2021-07-07 16:11:07.228438: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA
2021-07-07 16:11:07.233731: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2494140000 Hz
2021-07-07 16:11:07.234127: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x4239f10 initialized for platform Host (this does not guarantee that XLA will be used). Devices:
2021-07-07 16:11:07.234153: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (0): Host, Default Version
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:99: The name tf.summary.scalar is deprecated. Please use tf.compat.v1.summary.scalar instead.

W0707 16:12:06.256918 139897005205312 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:99: The name tf.summary.scalar is deprecated. Please use tf.compat.v1.summary.scalar instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:114: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0707 16:12:06.258975 139897005205312 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:114: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:116: Print (from tensorflow.python.ops.logging_ops) is deprecated and will be removed after 2018-08-20.
Instructions for updating:
Use tf.print instead of tf.Print. Note that tf.print returns a no-output operator that directly prints the output. Outside of defuns or eager mode, this operator will not be executed unless it is directly specified in session.run or used as a control dependency for other operators. This is only a concern in graph mode. Below is an example of how to ensure tf.print executes in graph mode:

W0707 16:12:06.260123 139897005205312 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:116: Print (from tensorflow.python.ops.logging_ops) is deprecated and will be removed after 2018-08-20.
Instructions for updating:
Use tf.print instead of tf.Print. Note that tf.print returns a no-output operator that directly prints the output. Outside of defuns or eager mode, this operator will not be executed unless it is directly specified in session.run or used as a control dependency for other operators. This is only a concern in graph mode. Below is an example of how to ensure tf.print executes in graph mode:

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:124: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0707 16:12:06.957652 139897005205312 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:124: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/DNN.py:62: The name tf.get_variable_scope is deprecated. Please use tf.compat.v1.get_variable_scope instead.

W0707 16:12:08.199504 139897005205312 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/DNN.py:62: The name tf.get_variable_scope is deprecated. Please use tf.compat.v1.get_variable_scope instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/DNN.py:63: The name tf.AUTO_REUSE is deprecated. Please use tf.compat.v1.AUTO_REUSE instead.

W0707 16:12:08.199878 139897005205312 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/DNN.py:63: The name tf.AUTO_REUSE is deprecated. Please use tf.compat.v1.AUTO_REUSE instead.

WARNING:tensorflow:From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/ops/resource_variable_ops.py:1630: calling BaseResourceVariable.__init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
W0707 16:12:08.265929 139897005205312 deprecation.py:506] From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/ops/resource_variable_ops.py:1630: calling BaseResourceVariable.__init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/base_ranking_model.py:121: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0707 16:12:08.290755 139897005205312 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/base_ranking_model.py:121: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:85: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0707 16:12:11.038016 139897005205312 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:85: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:278: to_float (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0707 16:12:13.216778 139897005205312 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:278: to_float (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:172: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0707 16:12:13.607915 139897005205312 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:172: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:262: The name tf.summary.merge_all is deprecated. Please use tf.compat.v1.summary.merge_all instead.

W0707 16:12:13.905146 139897005205312 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:262: The name tf.summary.merge_all is deprecated. Please use tf.compat.v1.summary.merge_all instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:264: The name tf.train.Saver is deprecated. Please use tf.compat.v1.train.Saver instead.

W0707 16:12:13.906639 139897005205312 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:264: The name tf.train.Saver is deprecated. Please use tf.compat.v1.train.Saver instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:264: The name tf.global_variables is deprecated. Please use tf.compat.v1.global_variables instead.

W0707 16:12:13.906824 139897005205312 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:264: The name tf.global_variables is deprecated. Please use tf.compat.v1.global_variables instead.

INFO:tensorflow:Restoring parameters from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_model_mtl_pointwiseem_nodecay_nocorr/ultra.learning_algorithm.PairwiseRegressionEM.ckpt-3350
I0707 16:12:13.933105 139897005205312 saver.py:1284] Restoring parameters from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_model_mtl_pointwiseem_nodecay_nocorr/ultra.learning_algorithm.PairwiseRegressionEM.ckpt-3350
WARNING:tensorflow:From main.py:296: The name tf.summary.FileWriter is deprecated. Please use tf.compat.v1.summary.FileWriter instead.

W0707 16:12:14.606174 139897005205312 module_wrapper.py:139] From main.py:296: The name tf.summary.FileWriter is deprecated. Please use tf.compat.v1.summary.FileWriter instead.

Reading data in /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_data/
Read data from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_data//test in ULTRA format.
Feature reading finish.
List reading finish.
Label reading finish.
Remove 1 invalid queries.
Data reading finish!
Finished reading 1927 queries with lists.
Build Pairwise RegressionEM algorithm.
corr_point_clk_noise=False,step_decay_ratio=0,pointwise_only=True
in pairwise regem.. hparams: [('EM_step_size', 0.05), ('clk_noise_EM_ratio', 1.0), ('corr_pair_clk_noise', True), ('corr_point_clk_noise', False), ('discount_fn', 'log1p'), ('enable_ips', False), ('gain_fn', 'exp'), ('grad_strategy', 'ada'), ('l2_loss', 0.0), ('learning_rate', 0.05), ('max_gradient_norm', 5.0), ('opt_metric', 'ndcg'), ('pointwise_only', True), ('reg_em_type', 0), ('step_decay_ratio', 0.0)]
<ultra.utils.losses_impl.DCGLambdaWeight object at 0x7f3b4dc599b0>
ranking_model: <class 'ultra.ranking_model.DNN.DNN'>
kwargs: {'rank_list_size': 514, 'forward_only': False}
Reading model parameters from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_model_mtl_pointwiseem_nodecay_nocorr/ultra.learning_algorithm.PairwiseRegressionEM.ckpt-3350
Create direct label feed with list size 514 with feature size 136
Testing 13% finishedTesting 27% finishedTesting 40% finishedTesting 53% finishedTesting 66% finishedTesting 80% finishedTesting 93% finishedTesting 100% finishedWARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/data_utils.py:367: The name tf.Summary is deprecated. Please use tf.compat.v1.Summary instead.

W0707 16:12:33.906809 139897005205312 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/data_utils.py:367: The name tf.Summary is deprecated. Please use tf.compat.v1.Summary instead.


[Done]
  eval: mrr_3:0.775 mrr_5:0.775 mrr_10:0.775 ndcg_3:0.341 ndcg_5:0.348 ndcg_10:0.375
