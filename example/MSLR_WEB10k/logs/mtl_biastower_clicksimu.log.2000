--data_dir=./MSLR_10k_letor/tmp_data/ --model_dir=./MSLR_10k_letor/tmp_model_mtl_biastower/ --output_dir=./MSLR_10k_letor/tmp_output/ --setting_file=./example/offline_setting/biastower_mtl_exp_settings.json
WARNING:tensorflow:From main.py:272: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

WARNING:tensorflow:From main.py:107: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

W0630 19:40:19.812482 140405670852416 module_wrapper.py:139] From main.py:107: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

WARNING:tensorflow:From main.py:109: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

W0630 19:40:19.812836 140405670852416 module_wrapper.py:139] From main.py:109: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2021-06-30 19:40:19.813418: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA
2021-06-30 19:40:19.820514: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2494140000 Hz
2021-06-30 19:40:19.820934: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x3f10bd0 initialized for platform Host (this does not guarantee that XLA will be used). Devices:
2021-06-30 19:40:19.820963: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (0): Host, Default Version
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_algorithm.py:55: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0630 19:40:19.826985 140405670852416 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_algorithm.py:55: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:118: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0630 19:40:22.626177 140405670852416 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:118: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/BiasTowerDNN.py:65: The name tf.get_variable_scope is deprecated. Please use tf.compat.v1.get_variable_scope instead.

W0630 19:40:24.230216 140405670852416 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/BiasTowerDNN.py:65: The name tf.get_variable_scope is deprecated. Please use tf.compat.v1.get_variable_scope instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/BiasTowerDNN.py:66: The name tf.AUTO_REUSE is deprecated. Please use tf.compat.v1.AUTO_REUSE instead.

W0630 19:40:24.230474 140405670852416 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/BiasTowerDNN.py:66: The name tf.AUTO_REUSE is deprecated. Please use tf.compat.v1.AUTO_REUSE instead.

WARNING:tensorflow:From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/ops/resource_variable_ops.py:1630: calling BaseResourceVariable.__init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
W0630 19:40:24.279924 140405670852416 deprecation.py:506] From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/ops/resource_variable_ops.py:1630: calling BaseResourceVariable.__init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/base_ranking_model.py:121: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0630 19:40:24.293535 140405670852416 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/base_ranking_model.py:121: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:85: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0630 19:40:26.065063 140405670852416 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:85: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:278: to_float (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0630 19:40:30.264994 140405670852416 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:278: to_float (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_algorithm.py:80: The name tf.summary.scalar is deprecated. Please use tf.compat.v1.summary.scalar instead.

W0630 19:40:30.304336 140405670852416 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_algorithm.py:80: The name tf.summary.scalar is deprecated. Please use tf.compat.v1.summary.scalar instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:172: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0630 19:40:30.843211 140405670852416 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:172: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:243: The name tf.losses.mean_squared_error is deprecated. Please use tf.compat.v1.losses.mean_squared_error instead.

W0630 19:40:31.566932 140405670852416 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:243: The name tf.losses.mean_squared_error is deprecated. Please use tf.compat.v1.losses.mean_squared_error instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:244: The name tf.losses.Reduction is deprecated. Please use tf.compat.v1.losses.Reduction instead.

W0630 19:40:31.567177 140405670852416 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:244: The name tf.losses.Reduction is deprecated. Please use tf.compat.v1.losses.Reduction instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_algorithm.py:128: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0630 19:40:31.574410 140405670852416 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_algorithm.py:128: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_algorithm.py:140: The name tf.train.AdagradOptimizer is deprecated. Please use tf.compat.v1.train.AdagradOptimizer instead.

W0630 19:40:31.574678 140405670852416 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_algorithm.py:140: The name tf.train.AdagradOptimizer is deprecated. Please use tf.compat.v1.train.AdagradOptimizer instead.

WARNING:tensorflow:From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/training/adagrad.py:76: calling Constant.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0630 19:40:32.292523 140405670852416 deprecation.py:506] From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/training/adagrad.py:76: calling Constant.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
INFO:tensorflow:Summary name Gradient Norm is illegal; using Gradient_Norm instead.
I0630 19:40:32.436245 140405670852416 summary_op_util.py:66] Summary name Gradient Norm is illegal; using Gradient_Norm instead.
INFO:tensorflow:Summary name Learning Rate is illegal; using Learning_Rate instead.
I0630 19:40:32.437405 140405670852416 summary_op_util.py:66] Summary name Learning Rate is illegal; using Learning_Rate instead.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_algorithm.py:177: The name tf.summary.merge_all is deprecated. Please use tf.compat.v1.summary.merge_all instead.

W0630 19:40:32.964676 140405670852416 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_algorithm.py:177: The name tf.summary.merge_all is deprecated. Please use tf.compat.v1.summary.merge_all instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_algorithm.py:179: The name tf.train.Saver is deprecated. Please use tf.compat.v1.train.Saver instead.

W0630 19:40:32.966485 140405670852416 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_algorithm.py:179: The name tf.train.Saver is deprecated. Please use tf.compat.v1.train.Saver instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_algorithm.py:179: The name tf.global_variables is deprecated. Please use tf.compat.v1.global_variables instead.

W0630 19:40:32.966678 140405670852416 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_algorithm.py:179: The name tf.global_variables is deprecated. Please use tf.compat.v1.global_variables instead.

WARNING:tensorflow:From main.py:74: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

W0630 19:40:33.026359 140405670852416 module_wrapper.py:139] From main.py:74: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

WARNING:tensorflow:From main.py:123: The name tf.summary.FileWriter is deprecated. Please use tf.compat.v1.summary.FileWriter instead.

W0630 19:40:34.118502 140405670852416 module_wrapper.py:139] From main.py:123: The name tf.summary.FileWriter is deprecated. Please use tf.compat.v1.summary.FileWriter instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/data_utils.py:367: The name tf.Summary is deprecated. Please use tf.compat.v1.Summary instead.

W0630 19:41:13.027993 140405670852416 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/data_utils.py:367: The name tf.Summary is deprecated. Please use tf.compat.v1.Summary instead.

Reading data in ./MSLR_10k_letor/tmp_data/
Read data from ./MSLR_10k_letor/tmp_data//train in ULTRA format.
Feature reading finish.
List reading finish.
Label reading finish.
Remove 183 invalid queries.
Data reading finish!
Finished reading 5817 queries with lists.
Read data from ./MSLR_10k_letor/tmp_data//valid in ULTRA format.
Feature reading finish.
List reading finish.
Label reading finish.
Remove 0 invalid queries.
Data reading finish!
Finished reading 1939 queries with lists.
Train Rank list size 809
Valid Rank list size 908
Users can only see the top 10 documents for each query in training.
Creating model...
Build NavieAlgorithm
hparams: loss_func=mse_loss
loss_func: mse_loss
ranking_model: <class 'ultra.ranking_model.BiasTowerDNN.BiasTowerDNN'>
kwargs: {'rank_list_size': 908, 'forward_only': True}
input_data shape: [None, 136]
output_data shape before add bias: [None, 1]
in bias tower.. forward_only: True
in bias tower.. rank_list_size: 908
output_data shape: [None, 1]
kwargs: {'rank_list_size': 10, 'forward_only': False}
input_data shape: [None, 136]
output_data shape before add bias: [None, 1]
in bias tower.. forward_only: False
in bias tower.. rank_list_size: 10
ps_input in  0 : Tensor("ranking_model_1/ranking_model/mul:0", shape=(?,), dtype=int32)
pos_embedding in  0 : Tensor("ranking_model_1/ranking_model/embedding_lookup/Identity:0", shape=(?, 24), dtype=float32)
ps_input in  1 : Tensor("ranking_model_1/ranking_model/mul_1:0", shape=(?,), dtype=int32)
pos_embedding in  1 : Tensor("ranking_model_1/ranking_model/embedding_lookup_1/Identity:0", shape=(?, 24), dtype=float32)
ps_input in  2 : Tensor("ranking_model_1/ranking_model/mul_2:0", shape=(?,), dtype=int32)
pos_embedding in  2 : Tensor("ranking_model_1/ranking_model/embedding_lookup_2/Identity:0", shape=(?, 24), dtype=float32)
ps_input in  3 : Tensor("ranking_model_1/ranking_model/mul_3:0", shape=(?,), dtype=int32)
pos_embedding in  3 : Tensor("ranking_model_1/ranking_model/embedding_lookup_3/Identity:0", shape=(?, 24), dtype=float32)
ps_input in  4 : Tensor("ranking_model_1/ranking_model/mul_4:0", shape=(?,), dtype=int32)
pos_embedding in  4 : Tensor("ranking_model_1/ranking_model/embedding_lookup_4/Identity:0", shape=(?, 24), dtype=float32)
ps_input in  5 : Tensor("ranking_model_1/ranking_model/mul_5:0", shape=(?,), dtype=int32)
pos_embedding in  5 : Tensor("ranking_model_1/ranking_model/embedding_lookup_5/Identity:0", shape=(?, 24), dtype=float32)
ps_input in  6 : Tensor("ranking_model_1/ranking_model/mul_6:0", shape=(?,), dtype=int32)
pos_embedding in  6 : Tensor("ranking_model_1/ranking_model/embedding_lookup_6/Identity:0", shape=(?, 24), dtype=float32)
ps_input in  7 : Tensor("ranking_model_1/ranking_model/mul_7:0", shape=(?,), dtype=int32)
pos_embedding in  7 : Tensor("ranking_model_1/ranking_model/embedding_lookup_7/Identity:0", shape=(?, 24), dtype=float32)
ps_input in  8 : Tensor("ranking_model_1/ranking_model/mul_8:0", shape=(?,), dtype=int32)
pos_embedding in  8 : Tensor("ranking_model_1/ranking_model/embedding_lookup_8/Identity:0", shape=(?, 24), dtype=float32)
ps_input in  9 : Tensor("ranking_model_1/ranking_model/mul_9:0", shape=(?,), dtype=int32)
pos_embedding in  9 : Tensor("ranking_model_1/ranking_model/embedding_lookup_9/Identity:0", shape=(?, 24), dtype=float32)
in bias tower.. bias_input shape: [None, 24]
output_data shape: [None, 1]
Created model with fresh parameters.
Create simluated clicks feed

Create direct label feed with list size 908 with feature size 136
global step 50 learning rate 0.0500 step-time 0.20 loss 67.4993
  valid: mrr_3:0.778 mrr_5:0.778 mrr_10:0.778 ndcg_3:0.299 ndcg_5:0.315 ndcg_10:0.343
Save model, valid ndcg_10:0.343
global step 100 learning rate 0.0500 step-time 0.16 loss 22.7635
  valid: mrr_3:0.768 mrr_5:0.768 mrr_10:0.768 ndcg_3:0.307 ndcg_5:0.317 ndcg_10:0.346
Save model, valid ndcg_10:0.346
global step 150 learning rate 0.0500 step-time 0.16 loss 21.8098
  valid: mrr_3:0.734 mrr_5:0.734 mrr_10:0.734 ndcg_3:0.295 ndcg_5:0.309 ndcg_10:0.341
global step 200 learning rate 0.0500 step-time 0.16 loss 21.7618
  valid: mrr_3:0.700 mrr_5:0.700 mrr_10:0.700 ndcg_3:0.273 ndcg_5:0.290 ndcg_10:0.325
global step 250 learning rate 0.0500 step-time 0.16 loss 21.1765
  valid: mrr_3:0.692 mrr_5:0.692 mrr_10:0.692 ndcg_3:0.272 ndcg_5:0.286 ndcg_10:0.320
global step 300 learning rate 0.0500 step-time 0.16 loss 21.3370
  valid: mrr_3:0.669 mrr_5:0.669 mrr_10:0.669 ndcg_3:0.256 ndcg_5:0.273 ndcg_10:0.308
global step 350 learning rate 0.0500 step-time 0.16 loss 21.2544
  valid: mrr_3:0.634 mrr_5:0.634 mrr_10:0.634 ndcg_3:0.233 ndcg_5:0.249 ndcg_10:0.288
global step 400 learning rate 0.0500 step-time 0.16 loss 21.0696
  valid: mrr_3:0.669 mrr_5:0.669 mrr_10:0.669 ndcg_3:0.249 ndcg_5:0.263 ndcg_10:0.297
global step 450 learning rate 0.0500 step-time 0.16 loss 21.2245
  valid: mrr_3:0.680 mrr_5:0.680 mrr_10:0.680 ndcg_3:0.258 ndcg_5:0.271 ndcg_10:0.302
global step 500 learning rate 0.0500 step-time 0.16 loss 20.9855
  valid: mrr_3:0.689 mrr_5:0.689 mrr_10:0.689 ndcg_3:0.266 ndcg_5:0.277 ndcg_10:0.305
global step 550 learning rate 0.0500 step-time 0.16 loss 20.9493
  valid: mrr_3:0.703 mrr_5:0.703 mrr_10:0.703 ndcg_3:0.275 ndcg_5:0.287 ndcg_10:0.315
global step 600 learning rate 0.0500 step-time 0.16 loss 21.1422
  valid: mrr_3:0.703 mrr_5:0.703 mrr_10:0.703 ndcg_3:0.279 ndcg_5:0.290 ndcg_10:0.317
global step 650 learning rate 0.0500 step-time 0.16 loss 21.1005
  valid: mrr_3:0.730 mrr_5:0.730 mrr_10:0.730 ndcg_3:0.291 ndcg_5:0.300 ndcg_10:0.329
global step 700 learning rate 0.0500 step-time 0.16 loss 20.9025
  valid: mrr_3:0.734 mrr_5:0.734 mrr_10:0.734 ndcg_3:0.297 ndcg_5:0.308 ndcg_10:0.335
global step 750 learning rate 0.0500 step-time 0.16 loss 20.9105
  valid: mrr_3:0.695 mrr_5:0.695 mrr_10:0.695 ndcg_3:0.274 ndcg_5:0.287 ndcg_10:0.317
global step 800 learning rate 0.0500 step-time 0.16 loss 21.1098
  valid: mrr_3:0.725 mrr_5:0.725 mrr_10:0.725 ndcg_3:0.296 ndcg_5:0.308 ndcg_10:0.336
global step 850 learning rate 0.0500 step-time 0.16 loss 21.1861
  valid: mrr_3:0.723 mrr_5:0.723 mrr_10:0.723 ndcg_3:0.290 ndcg_5:0.302 ndcg_10:0.329
global step 900 learning rate 0.0500 step-time 0.16 loss 20.8081
  valid: mrr_3:0.756 mrr_5:0.756 mrr_10:0.756 ndcg_3:0.314 ndcg_5:0.325 ndcg_10:0.355
Save model, valid ndcg_10:0.355
global step 950 learning rate 0.0500 step-time 0.16 loss 21.1071
  valid: mrr_3:0.709 mrr_5:0.709 mrr_10:0.709 ndcg_3:0.285 ndcg_5:0.298 ndcg_10:0.327
global step 1000 learning rate 0.0500 step-time 0.18 loss 21.3149
  valid: mrr_3:0.692 mrr_5:0.692 mrr_10:0.692 ndcg_3:0.273 ndcg_5:0.283 ndcg_10:0.311
global step 1050 learning rate 0.0500 step-time 0.18 loss 21.3254
  valid: mrr_3:0.717 mrr_5:0.717 mrr_10:0.717 ndcg_3:0.290 ndcg_5:0.303 ndcg_10:0.330
global step 1100 learning rate 0.0500 step-time 0.18 loss 21.1196
  valid: mrr_3:0.759 mrr_5:0.759 mrr_10:0.759 ndcg_3:0.320 ndcg_5:0.332 ndcg_10:0.358
Save model, valid ndcg_10:0.358
global step 1150 learning rate 0.0500 step-time 0.18 loss 21.0190
  valid: mrr_3:0.685 mrr_5:0.685 mrr_10:0.685 ndcg_3:0.266 ndcg_5:0.278 ndcg_10:0.311
global step 1200 learning rate 0.0500 step-time 0.18 loss 20.8163
  valid: mrr_3:0.699 mrr_5:0.699 mrr_10:0.699 ndcg_3:0.283 ndcg_5:0.295 ndcg_10:0.323
global step 1250 learning rate 0.0500 step-time 0.18 loss 21.1019
  valid: mrr_3:0.710 mrr_5:0.710 mrr_10:0.710 ndcg_3:0.257 ndcg_5:0.273 ndcg_10:0.302
global step 1300 learning rate 0.0500 step-time 0.19 loss 20.9072
  valid: mrr_3:0.759 mrr_5:0.759 mrr_10:0.759 ndcg_3:0.321 ndcg_5:0.334 ndcg_10:0.358
global step 1350 learning rate 0.0500 step-time 0.42 loss 20.7922
  valid: mrr_3:0.731 mrr_5:0.731 mrr_10:0.731 ndcg_3:0.305 ndcg_5:0.317 ndcg_10:0.345
global step 1400 learning rate 0.0500 step-time 0.33 loss 21.0502
  valid: mrr_3:0.738 mrr_5:0.738 mrr_10:0.738 ndcg_3:0.308 ndcg_5:0.321 ndcg_10:0.346
global step 1450 learning rate 0.0500 step-time 0.31 loss 20.9946
  valid: mrr_3:0.695 mrr_5:0.695 mrr_10:0.695 ndcg_3:0.284 ndcg_5:0.295 ndcg_10:0.323
global step 1500 learning rate 0.0500 step-time 0.23 loss 21.0427
  valid: mrr_3:0.742 mrr_5:0.742 mrr_10:0.742 ndcg_3:0.315 ndcg_5:0.323 ndcg_10:0.349
global step 1550 learning rate 0.0500 step-time 0.23 loss 21.1179
  valid: mrr_3:0.764 mrr_5:0.764 mrr_10:0.764 ndcg_3:0.327 ndcg_5:0.335 ndcg_10:0.361
Save model, valid ndcg_10:0.361
global step 1600 learning rate 0.0500 step-time 0.24 loss 21.1085
  valid: mrr_3:0.733 mrr_5:0.733 mrr_10:0.733 ndcg_3:0.300 ndcg_5:0.309 ndcg_10:0.337
global step 1650 learning rate 0.0500 step-time 0.26 loss 20.7712
  valid: mrr_3:0.735 mrr_5:0.735 mrr_10:0.735 ndcg_3:0.306 ndcg_5:0.318 ndcg_10:0.346
global step 1700 learning rate 0.0500 step-time 0.29 loss 20.9788
  valid: mrr_3:0.695 mrr_5:0.695 mrr_10:0.695 ndcg_3:0.279 ndcg_5:0.290 ndcg_10:0.317
global step 1750 learning rate 0.0500 step-time 0.27 loss 20.6419
  valid: mrr_3:0.745 mrr_5:0.745 mrr_10:0.745 ndcg_3:0.319 ndcg_5:0.328 ndcg_10:0.351
WARNING:tensorflow:From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/training/saver.py:963: remove_checkpoint (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to delete files with this prefix.
W0630 19:58:54.266254 140405670852416 deprecation.py:323] From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/training/saver.py:963: remove_checkpoint (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to delete files with this prefix.
global step 1800 learning rate 0.0500 step-time 0.25 loss 20.7893
  valid: mrr_3:0.775 mrr_5:0.775 mrr_10:0.775 ndcg_3:0.330 ndcg_5:0.341 ndcg_10:0.366
Save model, valid ndcg_10:0.366
global step 1850 learning rate 0.0500 step-time 0.26 loss 21.1642
  valid: mrr_3:0.710 mrr_5:0.710 mrr_10:0.710 ndcg_3:0.297 ndcg_5:0.306 ndcg_10:0.331
global step 1900 learning rate 0.0500 step-time 0.25 loss 20.8863
  valid: mrr_3:0.713 mrr_5:0.713 mrr_10:0.713 ndcg_3:0.285 ndcg_5:0.294 ndcg_10:0.320
global step 1950 learning rate 0.0500 step-time 0.25 loss 20.8393
  valid: mrr_3:0.749 mrr_5:0.749 mrr_10:0.749 ndcg_3:0.322 ndcg_5:0.330 ndcg_10:0.355
global step 2000 learning rate 0.0500 step-time 0.25 loss 20.9137
  valid: mrr_3:0.756 mrr_5:0.756 mrr_10:0.756 ndcg_3:0.322 ndcg_5:0.333 ndcg_10:0.360
global step 2050 learning rate 0.0500 step-time 0.25 loss 20.8337
  valid: mrr_3:0.728 mrr_5:0.728 mrr_10:0.728 ndcg_3:0.302 ndcg_5:0.313 ndcg_10:0.338
WARNING:tensorflow:From main.py:272: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

WARNING:tensorflow:From main.py:207: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

W0630 20:02:07.535362 140446272558912 module_wrapper.py:139] From main.py:207: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

WARNING:tensorflow:From main.py:209: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

W0630 20:02:07.535873 140446272558912 module_wrapper.py:139] From main.py:209: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2021-06-30 20:02:07.536845: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA
2021-06-30 20:02:07.557406: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2494140000 Hz
2021-06-30 20:02:07.557820: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x566a2d0 initialized for platform Host (this does not guarantee that XLA will be used). Devices:
2021-06-30 20:02:07.557852: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (0): Host, Default Version
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_algorithm.py:55: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0630 20:03:08.130876 140446272558912 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_algorithm.py:55: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:118: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0630 20:03:08.790912 140446272558912 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:118: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/BiasTowerDNN.py:67: The name tf.get_variable_scope is deprecated. Please use tf.compat.v1.get_variable_scope instead.

W0630 20:03:09.991836 140446272558912 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/BiasTowerDNN.py:67: The name tf.get_variable_scope is deprecated. Please use tf.compat.v1.get_variable_scope instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/BiasTowerDNN.py:68: The name tf.AUTO_REUSE is deprecated. Please use tf.compat.v1.AUTO_REUSE instead.

W0630 20:03:09.992101 140446272558912 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/BiasTowerDNN.py:68: The name tf.AUTO_REUSE is deprecated. Please use tf.compat.v1.AUTO_REUSE instead.

WARNING:tensorflow:From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/ops/resource_variable_ops.py:1630: calling BaseResourceVariable.__init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
W0630 20:03:10.049303 140446272558912 deprecation.py:506] From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/ops/resource_variable_ops.py:1630: calling BaseResourceVariable.__init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/base_ranking_model.py:121: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0630 20:03:10.080770 140446272558912 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/base_ranking_model.py:121: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:85: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0630 20:03:12.448276 140446272558912 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:85: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:278: to_float (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0630 20:03:14.586396 140446272558912 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:278: to_float (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_algorithm.py:80: The name tf.summary.scalar is deprecated. Please use tf.compat.v1.summary.scalar instead.

W0630 20:03:14.611431 140446272558912 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_algorithm.py:80: The name tf.summary.scalar is deprecated. Please use tf.compat.v1.summary.scalar instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:172: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0630 20:03:14.987583 140446272558912 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:172: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_algorithm.py:177: The name tf.summary.merge_all is deprecated. Please use tf.compat.v1.summary.merge_all instead.

W0630 20:03:15.295034 140446272558912 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_algorithm.py:177: The name tf.summary.merge_all is deprecated. Please use tf.compat.v1.summary.merge_all instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_algorithm.py:179: The name tf.train.Saver is deprecated. Please use tf.compat.v1.train.Saver instead.

W0630 20:03:15.296038 140446272558912 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_algorithm.py:179: The name tf.train.Saver is deprecated. Please use tf.compat.v1.train.Saver instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_algorithm.py:179: The name tf.global_variables is deprecated. Please use tf.compat.v1.global_variables instead.

W0630 20:03:15.296219 140446272558912 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_algorithm.py:179: The name tf.global_variables is deprecated. Please use tf.compat.v1.global_variables instead.

INFO:tensorflow:Restoring parameters from ./MSLR_10k_letor/tmp_model_mtl_biastower/ultra.learning_algorithm.NavieAlgorithm.ckpt-1800
I0630 20:03:15.321709 140446272558912 saver.py:1284] Restoring parameters from ./MSLR_10k_letor/tmp_model_mtl_biastower/ultra.learning_algorithm.NavieAlgorithm.ckpt-1800
WARNING:tensorflow:From main.py:224: The name tf.summary.FileWriter is deprecated. Please use tf.compat.v1.summary.FileWriter instead.

W0630 20:03:15.745212 140446272558912 module_wrapper.py:139] From main.py:224: The name tf.summary.FileWriter is deprecated. Please use tf.compat.v1.summary.FileWriter instead.

Reading data in ./MSLR_10k_letor/tmp_data/
Read data from ./MSLR_10k_letor/tmp_data//test in ULTRA format.
Feature reading finish.
List reading finish.
Label reading finish.
Remove 1 invalid queries.
Data reading finish!
Finished reading 1927 queries with lists.
Build NavieAlgorithm
hparams: loss_func=mse_loss
loss_func: mse_loss
ranking_model: <class 'ultra.ranking_model.BiasTowerDNN.BiasTowerDNN'>
in bias tower dnn.. hparams: [('activation_func', 'elu'), ('bias_hidden_layer_sizes', [128, 64]), ('combine_mode', 'sum'), ('hidden_layer_sizes', [512, 256, 128]), ('initializer', 'glorot'), ('norm', 'layer'), ('position_embsize', 24)]
kwargs: {'rank_list_size': 514, 'forward_only': True}
input_data shape: [None, 136]
output_data shape before add bias: [None, 1]
in bias tower.. forward_only: True
in bias tower.. rank_list_size: 514
output_data shape: [None, 1]
Reading model parameters from ./MSLR_10k_letor/tmp_model_mtl_biastower/ultra.learning_algorithm.NavieAlgorithm.ckpt-1800
Create direct label feed with list size 514 with feature size 136
Testing 13% finishedTesting 27% finishedTesting 40% finishedTesting 53% finishedTesting 66% finishedTesting 80% finishedTesting 93% finishedTesting 100% finishedWARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/data_utils.py:367: The name tf.Summary is deprecated. Please use tf.compat.v1.Summary instead.

W0630 20:03:34.071810 140446272558912 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/data_utils.py:367: The name tf.Summary is deprecated. Please use tf.compat.v1.Summary instead.


[Done]
  eval: mrr_3:0.783 mrr_5:0.783 mrr_10:0.783 ndcg_3:0.337 ndcg_5:0.342 ndcg_10:0.367
