--data_dir=/data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_data/ --model_dir=/data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_model_mtl_pointwiseem_nodecay_nocorr/ --output_dir=/data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_output/ --setting_file=./example/offline_setting/pointwise_regression_EM_mtl_nocorr_nodecay_exp_settings.json
WARNING:tensorflow:From main.py:344: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

WARNING:tensorflow:From main.py:107: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

W0707 15:14:08.173305 139940726839104 module_wrapper.py:139] From main.py:107: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

WARNING:tensorflow:From main.py:109: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

W0707 15:14:08.173647 139940726839104 module_wrapper.py:139] From main.py:109: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2021-07-07 15:14:08.174254: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA
2021-07-07 15:14:08.181638: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2494140000 Hz
2021-07-07 15:14:08.182026: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x41111f0 initialized for platform Host (this does not guarantee that XLA will be used). Devices:
2021-07-07 15:14:08.182052: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (0): Host, Default Version
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:99: The name tf.summary.scalar is deprecated. Please use tf.compat.v1.summary.scalar instead.

W0707 15:14:08.198632 139940726839104 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:99: The name tf.summary.scalar is deprecated. Please use tf.compat.v1.summary.scalar instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:114: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0707 15:14:08.200658 139940726839104 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:114: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:116: Print (from tensorflow.python.ops.logging_ops) is deprecated and will be removed after 2018-08-20.
Instructions for updating:
Use tf.print instead of tf.Print. Note that tf.print returns a no-output operator that directly prints the output. Outside of defuns or eager mode, this operator will not be executed unless it is directly specified in session.run or used as a control dependency for other operators. This is only a concern in graph mode. Below is an example of how to ensure tf.print executes in graph mode:

W0707 15:14:08.201816 139940726839104 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:116: Print (from tensorflow.python.ops.logging_ops) is deprecated and will be removed after 2018-08-20.
Instructions for updating:
Use tf.print instead of tf.Print. Note that tf.print returns a no-output operator that directly prints the output. Outside of defuns or eager mode, this operator will not be executed unless it is directly specified in session.run or used as a control dependency for other operators. This is only a concern in graph mode. Below is an example of how to ensure tf.print executes in graph mode:

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:124: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0707 15:14:11.786528 139940726839104 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:124: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/DNN.py:62: The name tf.get_variable_scope is deprecated. Please use tf.compat.v1.get_variable_scope instead.

W0707 15:14:14.248795 139940726839104 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/DNN.py:62: The name tf.get_variable_scope is deprecated. Please use tf.compat.v1.get_variable_scope instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/DNN.py:63: The name tf.AUTO_REUSE is deprecated. Please use tf.compat.v1.AUTO_REUSE instead.

W0707 15:14:14.249040 139940726839104 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/DNN.py:63: The name tf.AUTO_REUSE is deprecated. Please use tf.compat.v1.AUTO_REUSE instead.

WARNING:tensorflow:From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/ops/resource_variable_ops.py:1630: calling BaseResourceVariable.__init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
W0707 15:14:14.296792 139940726839104 deprecation.py:506] From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/ops/resource_variable_ops.py:1630: calling BaseResourceVariable.__init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/base_ranking_model.py:121: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0707 15:14:14.310154 139940726839104 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/base_ranking_model.py:121: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:85: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0707 15:14:16.948083 139940726839104 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:85: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:278: to_float (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0707 15:14:23.334844 139940726839104 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:278: to_float (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:172: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0707 15:14:24.235839 139940726839104 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:172: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:173: The name tf.summary.histogram is deprecated. Please use tf.compat.v1.summary.histogram instead.

W0707 15:14:26.045578 139940726839104 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:173: The name tf.summary.histogram is deprecated. Please use tf.compat.v1.summary.histogram instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:469: calling reduce_sum_v1 (from tensorflow.python.ops.math_ops) with keep_dims is deprecated and will be removed in a future version.
Instructions for updating:
keep_dims is deprecated, use keepdims instead
W0707 15:14:26.103201 139940726839104 deprecation.py:506] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:469: calling reduce_sum_v1 (from tensorflow.python.ops.math_ops) with keep_dims is deprecated and will be removed in a future version.
Instructions for updating:
keep_dims is deprecated, use keepdims instead
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:48: The name tf.ceil is deprecated. Please use tf.math.ceil instead.

W0707 15:14:26.129524 139940726839104 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:48: The name tf.ceil is deprecated. Please use tf.math.ceil instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:48: The name tf.random_uniform is deprecated. Please use tf.random.uniform instead.

W0707 15:14:26.129735 139940726839104 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:48: The name tf.random_uniform is deprecated. Please use tf.random.uniform instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:206: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0707 15:14:26.142574 139940726839104 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:206: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:212: The name tf.train.AdagradOptimizer is deprecated. Please use tf.compat.v1.train.AdagradOptimizer instead.

W0707 15:14:26.142836 139940726839104 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:212: The name tf.train.AdagradOptimizer is deprecated. Please use tf.compat.v1.train.AdagradOptimizer instead.

WARNING:tensorflow:From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/training/adagrad.py:76: calling Constant.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0707 15:14:26.727428 139940726839104 deprecation.py:506] From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/training/adagrad.py:76: calling Constant.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:262: The name tf.summary.merge_all is deprecated. Please use tf.compat.v1.summary.merge_all instead.

W0707 15:14:27.650266 139940726839104 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:262: The name tf.summary.merge_all is deprecated. Please use tf.compat.v1.summary.merge_all instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:264: The name tf.train.Saver is deprecated. Please use tf.compat.v1.train.Saver instead.

W0707 15:14:27.659688 139940726839104 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:264: The name tf.train.Saver is deprecated. Please use tf.compat.v1.train.Saver instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:264: The name tf.global_variables is deprecated. Please use tf.compat.v1.global_variables instead.

W0707 15:14:27.659901 139940726839104 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:264: The name tf.global_variables is deprecated. Please use tf.compat.v1.global_variables instead.

WARNING:tensorflow:From main.py:74: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

W0707 15:14:27.716032 139940726839104 module_wrapper.py:139] From main.py:74: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

WARNING:tensorflow:From main.py:123: The name tf.summary.FileWriter is deprecated. Please use tf.compat.v1.summary.FileWriter instead.

W0707 15:14:28.839604 139940726839104 module_wrapper.py:139] From main.py:123: The name tf.summary.FileWriter is deprecated. Please use tf.compat.v1.summary.FileWriter instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/data_utils.py:367: The name tf.Summary is deprecated. Please use tf.compat.v1.Summary instead.

W0707 15:15:12.249539 139940726839104 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/data_utils.py:367: The name tf.Summary is deprecated. Please use tf.compat.v1.Summary instead.

Reading data in /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_data/
Read data from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_data//train in ULTRA format.
Feature reading finish.
List reading finish.
Label reading finish.
Remove 183 invalid queries.
Data reading finish!
Finished reading 5817 queries with lists.
Read data from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_data//valid in ULTRA format.
Feature reading finish.
List reading finish.
Label reading finish.
Remove 0 invalid queries.
Data reading finish!
Finished reading 1939 queries with lists.
Train Rank list size 809
Valid Rank list size 908
Users can only see the top 10 documents for each query in training.
Creating model...
Build Pairwise RegressionEM algorithm.
corr_point_clk_noise=False,step_decay_ratio=0,pointwise_only=True
in pairwise regem.. hparams: [('EM_step_size', 0.05), ('clk_noise_EM_ratio', 1.0), ('corr_pair_clk_noise', True), ('corr_point_clk_noise', False), ('discount_fn', 'log1p'), ('enable_ips', False), ('gain_fn', 'exp'), ('grad_strategy', 'ada'), ('l2_loss', 0.0), ('learning_rate', 0.05), ('max_gradient_norm', 5.0), ('opt_metric', 'ndcg'), ('pointwise_only', True), ('reg_em_type', 0), ('step_decay_ratio', 0.0)]
<ultra.utils.losses_impl.DCGLambdaWeight object at 0x7f45968729e8>
ranking_model: <class 'ultra.ranking_model.DNN.DNN'>
kwargs: {'rank_list_size': 908, 'forward_only': False}
kwargs: {'rank_list_size': 10, 'forward_only': False}
kwargs: {'rank_list_size': 10, 'forward_only': False}
kwargs: {'rank_list_size': 10, 'forward_only': False}
Created model with fresh parameters.
Create simluated clicks feed

Create direct label feed with list size 908 with feature size 136
global step 50 learning rate 0.0500 step-time 0.22 loss 5.0581
  valid: mrr_3:0.771 mrr_5:0.771 mrr_10:0.771 ndcg_3:0.274 ndcg_5:0.288 ndcg_10:0.318
Save model, valid ndcg_10:0.318
global step 100 learning rate 0.0500 step-time 0.20 loss 4.3051
  valid: mrr_3:0.747 mrr_5:0.747 mrr_10:0.747 ndcg_3:0.263 ndcg_5:0.275 ndcg_10:0.301
global step 150 learning rate 0.0500 step-time 0.20 loss 4.3517
  valid: mrr_3:0.726 mrr_5:0.726 mrr_10:0.726 ndcg_3:0.258 ndcg_5:0.271 ndcg_10:0.298
global step 200 learning rate 0.0500 step-time 0.20 loss 4.4000
  valid: mrr_3:0.729 mrr_5:0.729 mrr_10:0.729 ndcg_3:0.268 ndcg_5:0.286 ndcg_10:0.315
global step 250 learning rate 0.0500 step-time 0.20 loss 4.5196
  valid: mrr_3:0.691 mrr_5:0.691 mrr_10:0.691 ndcg_3:0.251 ndcg_5:0.272 ndcg_10:0.306
global step 300 learning rate 0.0500 step-time 0.22 loss 4.6237
  valid: mrr_3:0.687 mrr_5:0.687 mrr_10:0.687 ndcg_3:0.256 ndcg_5:0.277 ndcg_10:0.311
global step 350 learning rate 0.0500 step-time 0.19 loss 4.7593
  valid: mrr_3:0.706 mrr_5:0.706 mrr_10:0.706 ndcg_3:0.274 ndcg_5:0.292 ndcg_10:0.326
Save model, valid ndcg_10:0.326
global step 400 learning rate 0.0500 step-time 0.21 loss 4.8782
  valid: mrr_3:0.677 mrr_5:0.677 mrr_10:0.677 ndcg_3:0.252 ndcg_5:0.273 ndcg_10:0.308
global step 450 learning rate 0.0500 step-time 0.25 loss 4.9531
  valid: mrr_3:0.722 mrr_5:0.722 mrr_10:0.722 ndcg_3:0.288 ndcg_5:0.304 ndcg_10:0.338
Save model, valid ndcg_10:0.338
global step 500 learning rate 0.0500 step-time 0.28 loss 5.1347
  valid: mrr_3:0.704 mrr_5:0.704 mrr_10:0.704 ndcg_3:0.275 ndcg_5:0.294 ndcg_10:0.326
global step 550 learning rate 0.0500 step-time 0.26 loss 5.2172
  valid: mrr_3:0.741 mrr_5:0.741 mrr_10:0.741 ndcg_3:0.304 ndcg_5:0.318 ndcg_10:0.346
Save model, valid ndcg_10:0.346
global step 600 learning rate 0.0500 step-time 0.28 loss 5.2612
  valid: mrr_3:0.723 mrr_5:0.723 mrr_10:0.723 ndcg_3:0.291 ndcg_5:0.308 ndcg_10:0.337
global step 650 learning rate 0.0500 step-time 0.24 loss 5.3340
  valid: mrr_3:0.730 mrr_5:0.730 mrr_10:0.730 ndcg_3:0.294 ndcg_5:0.304 ndcg_10:0.330
global step 700 learning rate 0.0500 step-time 0.28 loss 5.4363
  valid: mrr_3:0.697 mrr_5:0.697 mrr_10:0.697 ndcg_3:0.275 ndcg_5:0.290 ndcg_10:0.320
global step 750 learning rate 0.0500 step-time 0.26 loss 5.4618
  valid: mrr_3:0.686 mrr_5:0.686 mrr_10:0.686 ndcg_3:0.268 ndcg_5:0.285 ndcg_10:0.316
global step 800 learning rate 0.0500 step-time 0.30 loss 5.4579
  valid: mrr_3:0.734 mrr_5:0.734 mrr_10:0.734 ndcg_3:0.305 ndcg_5:0.317 ndcg_10:0.345
global step 850 learning rate 0.0500 step-time 0.28 loss 5.5425
  valid: mrr_3:0.731 mrr_5:0.731 mrr_10:0.731 ndcg_3:0.301 ndcg_5:0.315 ndcg_10:0.343
global step 900 learning rate 0.0500 step-time 0.25 loss 5.5824
  valid: mrr_3:0.703 mrr_5:0.703 mrr_10:0.703 ndcg_3:0.286 ndcg_5:0.298 ndcg_10:0.327
global step 950 learning rate 0.0500 step-time 0.29 loss 5.5763
  valid: mrr_3:0.729 mrr_5:0.729 mrr_10:0.729 ndcg_3:0.297 ndcg_5:0.309 ndcg_10:0.335
global step 1000 learning rate 0.0500 step-time 0.26 loss 5.6604
  valid: mrr_3:0.718 mrr_5:0.718 mrr_10:0.718 ndcg_3:0.295 ndcg_5:0.309 ndcg_10:0.339
global step 1050 learning rate 0.0500 step-time 0.27 loss 5.7282
  valid: mrr_3:0.729 mrr_5:0.729 mrr_10:0.729 ndcg_3:0.297 ndcg_5:0.307 ndcg_10:0.334
global step 1100 learning rate 0.0500 step-time 0.28 loss 5.6829
  valid: mrr_3:0.705 mrr_5:0.705 mrr_10:0.705 ndcg_3:0.284 ndcg_5:0.302 ndcg_10:0.331
global step 1150 learning rate 0.0500 step-time 0.27 loss 5.7408
  valid: mrr_3:0.759 mrr_5:0.759 mrr_10:0.759 ndcg_3:0.315 ndcg_5:0.327 ndcg_10:0.353
Save model, valid ndcg_10:0.353
WARNING:tensorflow:From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/training/saver.py:963: remove_checkpoint (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to delete files with this prefix.
W0707 15:29:02.281337 139940726839104 deprecation.py:323] From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/training/saver.py:963: remove_checkpoint (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to delete files with this prefix.
global step 1200 learning rate 0.0500 step-time 0.28 loss 5.7033
  valid: mrr_3:0.757 mrr_5:0.757 mrr_10:0.757 ndcg_3:0.318 ndcg_5:0.326 ndcg_10:0.353
Save model, valid ndcg_10:0.353
global step 1250 learning rate 0.0500 step-time 0.25 loss 5.7340
  valid: mrr_3:0.702 mrr_5:0.702 mrr_10:0.702 ndcg_3:0.283 ndcg_5:0.297 ndcg_10:0.327
global step 1300 learning rate 0.0500 step-time 0.29 loss 5.7634
  valid: mrr_3:0.685 mrr_5:0.685 mrr_10:0.685 ndcg_3:0.259 ndcg_5:0.269 ndcg_10:0.295
global step 1350 learning rate 0.0500 step-time 0.29 loss 5.7677
  valid: mrr_3:0.719 mrr_5:0.719 mrr_10:0.719 ndcg_3:0.280 ndcg_5:0.289 ndcg_10:0.313
global step 1400 learning rate 0.0500 step-time 0.29 loss 5.7899
  valid: mrr_3:0.759 mrr_5:0.759 mrr_10:0.759 ndcg_3:0.320 ndcg_5:0.331 ndcg_10:0.355
Save model, valid ndcg_10:0.355
global step 1450 learning rate 0.0500 step-time 0.28 loss 5.8095
  valid: mrr_3:0.706 mrr_5:0.706 mrr_10:0.706 ndcg_3:0.268 ndcg_5:0.280 ndcg_10:0.306
global step 1500 learning rate 0.0500 step-time 0.24 loss 5.8363
  valid: mrr_3:0.710 mrr_5:0.710 mrr_10:0.710 ndcg_3:0.286 ndcg_5:0.299 ndcg_10:0.327
global step 1550 learning rate 0.0500 step-time 0.27 loss 5.8756
  valid: mrr_3:0.730 mrr_5:0.730 mrr_10:0.730 ndcg_3:0.302 ndcg_5:0.312 ndcg_10:0.342
global step 1600 learning rate 0.0500 step-time 0.26 loss 5.8802
  valid: mrr_3:0.745 mrr_5:0.745 mrr_10:0.745 ndcg_3:0.316 ndcg_5:0.323 ndcg_10:0.350
global step 1650 learning rate 0.0500 step-time 0.28 loss 5.8724
  valid: mrr_3:0.714 mrr_5:0.714 mrr_10:0.714 ndcg_3:0.286 ndcg_5:0.295 ndcg_10:0.320
global step 1700 learning rate 0.0500 step-time 0.29 loss 5.8986
  valid: mrr_3:0.713 mrr_5:0.713 mrr_10:0.713 ndcg_3:0.288 ndcg_5:0.296 ndcg_10:0.320
global step 1750 learning rate 0.0500 step-time 0.27 loss 5.8834
  valid: mrr_3:0.731 mrr_5:0.731 mrr_10:0.731 ndcg_3:0.301 ndcg_5:0.312 ndcg_10:0.342
global step 1800 learning rate 0.0500 step-time 0.27 loss 5.9193
  valid: mrr_3:0.722 mrr_5:0.722 mrr_10:0.722 ndcg_3:0.289 ndcg_5:0.300 ndcg_10:0.327
global step 1850 learning rate 0.0500 step-time 0.26 loss 5.8683
  valid: mrr_3:0.714 mrr_5:0.714 mrr_10:0.714 ndcg_3:0.277 ndcg_5:0.288 ndcg_10:0.313
global step 1900 learning rate 0.0500 step-time 0.28 loss 5.9049
  valid: mrr_3:0.738 mrr_5:0.738 mrr_10:0.738 ndcg_3:0.301 ndcg_5:0.309 ndcg_10:0.340
global step 1950 learning rate 0.0500 step-time 0.26 loss 5.9233
  valid: mrr_3:0.739 mrr_5:0.739 mrr_10:0.739 ndcg_3:0.308 ndcg_5:0.320 ndcg_10:0.347
global step 2000 learning rate 0.0500 step-time 0.30 loss 5.8676
  valid: mrr_3:0.759 mrr_5:0.759 mrr_10:0.759 ndcg_3:0.324 ndcg_5:0.334 ndcg_10:0.362
Save model, valid ndcg_10:0.362
global step 2050 learning rate 0.0500 step-time 0.28 loss 5.9314
  valid: mrr_3:0.760 mrr_5:0.760 mrr_10:0.760 ndcg_3:0.325 ndcg_5:0.335 ndcg_10:0.359
WARNING:tensorflow:From main.py:344: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

WARNING:tensorflow:From main.py:279: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

W0707 15:40:23.436943 139990848575296 module_wrapper.py:139] From main.py:279: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

WARNING:tensorflow:From main.py:281: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

W0707 15:40:23.437185 139990848575296 module_wrapper.py:139] From main.py:281: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2021-07-07 15:40:23.437728: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA
2021-07-07 15:40:23.442692: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2494140000 Hz
2021-07-07 15:40:23.443163: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x483ef10 initialized for platform Host (this does not guarantee that XLA will be used). Devices:
2021-07-07 15:40:23.443187: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (0): Host, Default Version
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:99: The name tf.summary.scalar is deprecated. Please use tf.compat.v1.summary.scalar instead.

W0707 15:41:20.914255 139990848575296 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:99: The name tf.summary.scalar is deprecated. Please use tf.compat.v1.summary.scalar instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:114: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0707 15:41:20.919123 139990848575296 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:114: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:116: Print (from tensorflow.python.ops.logging_ops) is deprecated and will be removed after 2018-08-20.
Instructions for updating:
Use tf.print instead of tf.Print. Note that tf.print returns a no-output operator that directly prints the output. Outside of defuns or eager mode, this operator will not be executed unless it is directly specified in session.run or used as a control dependency for other operators. This is only a concern in graph mode. Below is an example of how to ensure tf.print executes in graph mode:

W0707 15:41:20.921788 139990848575296 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:116: Print (from tensorflow.python.ops.logging_ops) is deprecated and will be removed after 2018-08-20.
Instructions for updating:
Use tf.print instead of tf.Print. Note that tf.print returns a no-output operator that directly prints the output. Outside of defuns or eager mode, this operator will not be executed unless it is directly specified in session.run or used as a control dependency for other operators. This is only a concern in graph mode. Below is an example of how to ensure tf.print executes in graph mode:

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:124: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0707 15:41:21.543751 139990848575296 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:124: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/DNN.py:62: The name tf.get_variable_scope is deprecated. Please use tf.compat.v1.get_variable_scope instead.

W0707 15:41:22.965526 139990848575296 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/DNN.py:62: The name tf.get_variable_scope is deprecated. Please use tf.compat.v1.get_variable_scope instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/DNN.py:63: The name tf.AUTO_REUSE is deprecated. Please use tf.compat.v1.AUTO_REUSE instead.

W0707 15:41:22.969034 139990848575296 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/DNN.py:63: The name tf.AUTO_REUSE is deprecated. Please use tf.compat.v1.AUTO_REUSE instead.

WARNING:tensorflow:From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/ops/resource_variable_ops.py:1630: calling BaseResourceVariable.__init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
W0707 15:41:23.002095 139990848575296 deprecation.py:506] From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/ops/resource_variable_ops.py:1630: calling BaseResourceVariable.__init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/base_ranking_model.py:121: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0707 15:41:23.016034 139990848575296 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/base_ranking_model.py:121: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:85: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0707 15:41:25.232755 139990848575296 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:85: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:278: to_float (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0707 15:41:28.284900 139990848575296 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:278: to_float (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:172: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0707 15:41:28.841655 139990848575296 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:172: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:262: The name tf.summary.merge_all is deprecated. Please use tf.compat.v1.summary.merge_all instead.

W0707 15:41:29.263405 139990848575296 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:262: The name tf.summary.merge_all is deprecated. Please use tf.compat.v1.summary.merge_all instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:264: The name tf.train.Saver is deprecated. Please use tf.compat.v1.train.Saver instead.

W0707 15:41:29.265491 139990848575296 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:264: The name tf.train.Saver is deprecated. Please use tf.compat.v1.train.Saver instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:264: The name tf.global_variables is deprecated. Please use tf.compat.v1.global_variables instead.

W0707 15:41:29.265762 139990848575296 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/pairwise_reg_em.py:264: The name tf.global_variables is deprecated. Please use tf.compat.v1.global_variables instead.

INFO:tensorflow:Restoring parameters from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_model_mtl_pointwiseem_nodecay_nocorr/ultra.learning_algorithm.PairwiseRegressionEM.ckpt-2000
I0707 15:41:29.301754 139990848575296 saver.py:1284] Restoring parameters from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_model_mtl_pointwiseem_nodecay_nocorr/ultra.learning_algorithm.PairwiseRegressionEM.ckpt-2000
WARNING:tensorflow:From main.py:296: The name tf.summary.FileWriter is deprecated. Please use tf.compat.v1.summary.FileWriter instead.

W0707 15:41:29.808581 139990848575296 module_wrapper.py:139] From main.py:296: The name tf.summary.FileWriter is deprecated. Please use tf.compat.v1.summary.FileWriter instead.

Reading data in /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_data/
Read data from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_data//test in ULTRA format.
Feature reading finish.
List reading finish.
Label reading finish.
Remove 1 invalid queries.
Data reading finish!
Finished reading 1927 queries with lists.
Build Pairwise RegressionEM algorithm.
corr_point_clk_noise=False,step_decay_ratio=0,pointwise_only=True
in pairwise regem.. hparams: [('EM_step_size', 0.05), ('clk_noise_EM_ratio', 1.0), ('corr_pair_clk_noise', True), ('corr_point_clk_noise', False), ('discount_fn', 'log1p'), ('enable_ips', False), ('gain_fn', 'exp'), ('grad_strategy', 'ada'), ('l2_loss', 0.0), ('learning_rate', 0.05), ('max_gradient_norm', 5.0), ('opt_metric', 'ndcg'), ('pointwise_only', True), ('reg_em_type', 0), ('step_decay_ratio', 0.0)]
<ultra.utils.losses_impl.DCGLambdaWeight object at 0x7f51274999b0>
ranking_model: <class 'ultra.ranking_model.DNN.DNN'>
kwargs: {'rank_list_size': 514, 'forward_only': False}
Reading model parameters from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_model_mtl_pointwiseem_nodecay_nocorr/ultra.learning_algorithm.PairwiseRegressionEM.ckpt-2000
Create direct label feed with list size 514 with feature size 136
Testing 13% finishedTesting 27% finishedTesting 40% finishedTesting 53% finishedTesting 66% finishedTesting 80% finishedTesting 93% finishedTesting 100% finishedWARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/data_utils.py:367: The name tf.Summary is deprecated. Please use tf.compat.v1.Summary instead.

W0707 15:41:49.948281 139990848575296 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/data_utils.py:367: The name tf.Summary is deprecated. Please use tf.compat.v1.Summary instead.


[Done]
  eval: mrr_3:0.758 mrr_5:0.758 mrr_10:0.758 ndcg_3:0.325 ndcg_5:0.336 ndcg_10:0.361
