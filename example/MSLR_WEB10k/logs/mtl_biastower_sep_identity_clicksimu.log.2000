--data_dir=/data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_data/ --model_dir=/data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_model_mtl_biastower_sep_identity/ --output_dir=/data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_output/ --setting_file=./example/offline_setting/biastower_mtl_sep_exp_settings.json
WARNING:tensorflow:From main.py:344: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

WARNING:tensorflow:From main.py:107: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

W0709 20:41:36.868850 140012518360896 module_wrapper.py:139] From main.py:107: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

WARNING:tensorflow:From main.py:109: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

W0709 20:41:36.869193 140012518360896 module_wrapper.py:139] From main.py:109: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2021-07-09 20:41:36.869823: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA
2021-07-09 20:41:36.876946: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2494140000 Hz
2021-07-09 20:41:36.877324: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x52f1f90 initialized for platform Host (this does not guarantee that XLA will be used). Devices:
2021-07-09 20:41:36.877358: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (0): Host, Default Version
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py:56: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0709 20:41:36.883261 140012518360896 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py:56: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:124: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0709 20:41:39.654218 140012518360896 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:124: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/MTLBiasTowerDNN.py:69: The name tf.get_variable_scope is deprecated. Please use tf.compat.v1.get_variable_scope instead.

W0709 20:41:41.257545 140012518360896 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/MTLBiasTowerDNN.py:69: The name tf.get_variable_scope is deprecated. Please use tf.compat.v1.get_variable_scope instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/MTLBiasTowerDNN.py:70: The name tf.AUTO_REUSE is deprecated. Please use tf.compat.v1.AUTO_REUSE instead.

W0709 20:41:41.257789 140012518360896 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/MTLBiasTowerDNN.py:70: The name tf.AUTO_REUSE is deprecated. Please use tf.compat.v1.AUTO_REUSE instead.

WARNING:tensorflow:From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/ops/resource_variable_ops.py:1630: calling BaseResourceVariable.__init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
W0709 20:41:41.307811 140012518360896 deprecation.py:506] From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/ops/resource_variable_ops.py:1630: calling BaseResourceVariable.__init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/base_ranking_model.py:121: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0709 20:41:41.321372 140012518360896 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/base_ranking_model.py:121: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:85: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0709 20:41:43.212149 140012518360896 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:85: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:278: to_float (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0709 20:41:48.753329 140012518360896 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:278: to_float (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py:100: The name tf.summary.scalar is deprecated. Please use tf.compat.v1.summary.scalar instead.

W0709 20:41:48.792598 140012518360896 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py:100: The name tf.summary.scalar is deprecated. Please use tf.compat.v1.summary.scalar instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:172: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0709 20:41:49.470673 140012518360896 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:172: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
INFO:tensorflow:Summary name Max_output_score_'click' is illegal; using Max_output_score__click_ instead.
I0709 20:41:50.306899 140012518360896 summary_op_util.py:66] Summary name Max_output_score_'click' is illegal; using Max_output_score__click_ instead.
INFO:tensorflow:Summary name Min_output_score_'click' is illegal; using Min_output_score__click_ instead.
I0709 20:41:50.309090 140012518360896 summary_op_util.py:66] Summary name Min_output_score_'click' is illegal; using Min_output_score__click_ instead.
INFO:tensorflow:Summary name Max_output_score_without_pad_'click' is illegal; using Max_output_score_without_pad__click_ instead.
I0709 20:41:50.369074 140012518360896 summary_op_util.py:66] Summary name Max_output_score_without_pad_'click' is illegal; using Max_output_score_without_pad__click_ instead.
INFO:tensorflow:Summary name Min_output_score_without_pad_'click' is illegal; using Min_output_score_without_pad__click_ instead.
I0709 20:41:50.371271 140012518360896 summary_op_util.py:66] Summary name Min_output_score_without_pad_'click' is illegal; using Min_output_score_without_pad__click_ instead.
INFO:tensorflow:Summary name Max_output_score_'watchtime' is illegal; using Max_output_score__watchtime_ instead.
I0709 20:41:50.402903 140012518360896 summary_op_util.py:66] Summary name Max_output_score_'watchtime' is illegal; using Max_output_score__watchtime_ instead.
INFO:tensorflow:Summary name Min_output_score_'watchtime' is illegal; using Min_output_score__watchtime_ instead.
I0709 20:41:50.405042 140012518360896 summary_op_util.py:66] Summary name Min_output_score_'watchtime' is illegal; using Min_output_score__watchtime_ instead.
INFO:tensorflow:Summary name Max_output_score_without_pad_'watchtime' is illegal; using Max_output_score_without_pad__watchtime_ instead.
I0709 20:41:50.465426 140012518360896 summary_op_util.py:66] Summary name Max_output_score_without_pad_'watchtime' is illegal; using Max_output_score_without_pad__watchtime_ instead.
INFO:tensorflow:Summary name Min_output_score_without_pad_'watchtime' is illegal; using Min_output_score_without_pad__watchtime_ instead.
I0709 20:41:50.467623 140012518360896 summary_op_util.py:66] Summary name Min_output_score_without_pad_'watchtime' is illegal; using Min_output_score_without_pad__watchtime_ instead.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:253: The name tf.losses.mean_squared_error is deprecated. Please use tf.compat.v1.losses.mean_squared_error instead.

W0709 20:41:50.470437 140012518360896 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:253: The name tf.losses.mean_squared_error is deprecated. Please use tf.compat.v1.losses.mean_squared_error instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:254: The name tf.losses.Reduction is deprecated. Please use tf.compat.v1.losses.Reduction instead.

W0709 20:41:50.470612 140012518360896 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:254: The name tf.losses.Reduction is deprecated. Please use tf.compat.v1.losses.Reduction instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py:161: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0709 20:41:50.478215 140012518360896 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py:161: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py:173: The name tf.train.AdagradOptimizer is deprecated. Please use tf.compat.v1.train.AdagradOptimizer instead.

W0709 20:41:50.478449 140012518360896 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py:173: The name tf.train.AdagradOptimizer is deprecated. Please use tf.compat.v1.train.AdagradOptimizer instead.

WARNING:tensorflow:From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/training/adagrad.py:76: calling Constant.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0709 20:41:51.526814 140012518360896 deprecation.py:506] From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/training/adagrad.py:76: calling Constant.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
INFO:tensorflow:Summary name Gradient Norm is illegal; using Gradient_Norm instead.
I0709 20:41:51.702895 140012518360896 summary_op_util.py:66] Summary name Gradient Norm is illegal; using Gradient_Norm instead.
INFO:tensorflow:Summary name Learning Rate is illegal; using Learning_Rate instead.
I0709 20:41:51.704062 140012518360896 summary_op_util.py:66] Summary name Learning Rate is illegal; using Learning_Rate instead.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py:228: The name tf.summary.merge_all is deprecated. Please use tf.compat.v1.summary.merge_all instead.

W0709 20:41:52.240468 140012518360896 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py:228: The name tf.summary.merge_all is deprecated. Please use tf.compat.v1.summary.merge_all instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py:230: The name tf.train.Saver is deprecated. Please use tf.compat.v1.train.Saver instead.

W0709 20:41:52.242383 140012518360896 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py:230: The name tf.train.Saver is deprecated. Please use tf.compat.v1.train.Saver instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py:230: The name tf.global_variables is deprecated. Please use tf.compat.v1.global_variables instead.

W0709 20:41:52.242555 140012518360896 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py:230: The name tf.global_variables is deprecated. Please use tf.compat.v1.global_variables instead.

WARNING:tensorflow:From main.py:74: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

W0709 20:41:52.314592 140012518360896 module_wrapper.py:139] From main.py:74: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

WARNING:tensorflow:From main.py:123: The name tf.summary.FileWriter is deprecated. Please use tf.compat.v1.summary.FileWriter instead.

W0709 20:41:53.463217 140012518360896 module_wrapper.py:139] From main.py:123: The name tf.summary.FileWriter is deprecated. Please use tf.compat.v1.summary.FileWriter instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/data_utils.py:367: The name tf.Summary is deprecated. Please use tf.compat.v1.Summary instead.

W0709 20:42:56.237556 140012518360896 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/data_utils.py:367: The name tf.Summary is deprecated. Please use tf.compat.v1.Summary instead.

Reading data in /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_data/
Read data from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_data//train in ULTRA format.
Feature reading finish.
List reading finish.
Label reading finish.
Remove 183 invalid queries.
Data reading finish!
Finished reading 5817 queries with lists.
Read data from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_data//valid in ULTRA format.
Feature reading finish.
List reading finish.
Label reading finish.
Remove 0 invalid queries.
Data reading finish!
Finished reading 1939 queries with lists.
Train Rank list size 809
Valid Rank list size 908
Users can only see the top 10 documents for each query in training.
Creating model...
Build NavieAlgorithm
hparams: tasks=['click', 'watchtime']
ranking_model: <class 'ultra.ranking_model.MTLBiasTowerDNN.MTLBiasTowerDNN'>
in bias tower dnn.. hparams: [('activation_func', 'elu'), ('bias_hidden_layer_sizes', [128, 64]), ('combine_mode', 'sum'), ('hidden_layer_sizes', [512, 256, 128]), ('initializer', 'glorot'), ('norm', 'layer'), ('output_act', 'indentity'), ('position_embsize', 24), ('tasks', ['click', 'watchtime'])]
kwargs: {'rank_list_size': 908, 'forward_only': True}
input_data shape: [None, 136]
in bias tower.. forward_only: True
in bias tower.. rank_list_size: 908
res: [<tf.Tensor 'concat:0' shape=(?, 908) dtype=float32>, <tf.Tensor 'concat_1:0' shape=(?, 908) dtype=float32>]
loss func: sigmoid_cross_entropy
output_act: identity
identity on task  'click'
loss func: mse_loss
output_act: identity
identity on task  'watchtime'
reshaped_labels: Tensor("transpose:0", shape=(?, 908), dtype=float32)
kwargs: {'rank_list_size': 10, 'forward_only': False}
input_data shape: [None, 136]
in bias tower.. forward_only: False
in bias tower.. rank_list_size: 10
ps_input in  0 : Tensor("ranking_model_1/ranking_model/mul:0", shape=(?,), dtype=int32)
pos_embedding in  0 : Tensor("ranking_model_1/ranking_model/embedding_lookup/Identity:0", shape=(?, 24), dtype=float32)
ps_input in  1 : Tensor("ranking_model_1/ranking_model/mul_1:0", shape=(?,), dtype=int32)
pos_embedding in  1 : Tensor("ranking_model_1/ranking_model/embedding_lookup_1/Identity:0", shape=(?, 24), dtype=float32)
ps_input in  2 : Tensor("ranking_model_1/ranking_model/mul_2:0", shape=(?,), dtype=int32)
pos_embedding in  2 : Tensor("ranking_model_1/ranking_model/embedding_lookup_2/Identity:0", shape=(?, 24), dtype=float32)
ps_input in  3 : Tensor("ranking_model_1/ranking_model/mul_3:0", shape=(?,), dtype=int32)
pos_embedding in  3 : Tensor("ranking_model_1/ranking_model/embedding_lookup_3/Identity:0", shape=(?, 24), dtype=float32)
ps_input in  4 : Tensor("ranking_model_1/ranking_model/mul_4:0", shape=(?,), dtype=int32)
pos_embedding in  4 : Tensor("ranking_model_1/ranking_model/embedding_lookup_4/Identity:0", shape=(?, 24), dtype=float32)
ps_input in  5 : Tensor("ranking_model_1/ranking_model/mul_5:0", shape=(?,), dtype=int32)
pos_embedding in  5 : Tensor("ranking_model_1/ranking_model/embedding_lookup_5/Identity:0", shape=(?, 24), dtype=float32)
ps_input in  6 : Tensor("ranking_model_1/ranking_model/mul_6:0", shape=(?,), dtype=int32)
pos_embedding in  6 : Tensor("ranking_model_1/ranking_model/embedding_lookup_6/Identity:0", shape=(?, 24), dtype=float32)
ps_input in  7 : Tensor("ranking_model_1/ranking_model/mul_7:0", shape=(?,), dtype=int32)
pos_embedding in  7 : Tensor("ranking_model_1/ranking_model/embedding_lookup_7/Identity:0", shape=(?, 24), dtype=float32)
ps_input in  8 : Tensor("ranking_model_1/ranking_model/mul_8:0", shape=(?,), dtype=int32)
pos_embedding in  8 : Tensor("ranking_model_1/ranking_model/embedding_lookup_8/Identity:0", shape=(?, 24), dtype=float32)
ps_input in  9 : Tensor("ranking_model_1/ranking_model/mul_9:0", shape=(?,), dtype=int32)
pos_embedding in  9 : Tensor("ranking_model_1/ranking_model/embedding_lookup_9/Identity:0", shape=(?, 24), dtype=float32)
in bias tower.. bias_input shape: [None, 24]
output_data_bias shape: [None, 1]
res: [<tf.Tensor 'concat_3:0' shape=(?, 10) dtype=float32>, <tf.Tensor 'concat_4:0' shape=(?, 10) dtype=float32>]
train_labels: [<tf.Tensor 'Squeeze:0' shape=(?,) dtype=float32>, <tf.Tensor 'Squeeze_1:0' shape=(?,) dtype=float32>, <tf.Tensor 'Squeeze_2:0' shape=(?,) dtype=float32>, <tf.Tensor 'Squeeze_3:0' shape=(?,) dtype=float32>, <tf.Tensor 'Squeeze_4:0' shape=(?,) dtype=float32>, <tf.Tensor 'Squeeze_5:0' shape=(?,) dtype=float32>, <tf.Tensor 'Squeeze_6:0' shape=(?,) dtype=float32>, <tf.Tensor 'Squeeze_7:0' shape=(?,) dtype=float32>, <tf.Tensor 'Squeeze_8:0' shape=(?,) dtype=float32>, <tf.Tensor 'Squeeze_9:0' shape=(?,) dtype=float32>]
reshaped_train_labels: Tensor("transpose_1:0", shape=(?, 10), dtype=float32)
sigmoid_cross_entropy loss on task  'click'
train_labels: [<tf.Tensor 'Squeeze_10:0' shape=(?,) dtype=float32>, <tf.Tensor 'Squeeze_11:0' shape=(?,) dtype=float32>, <tf.Tensor 'Squeeze_12:0' shape=(?,) dtype=float32>, <tf.Tensor 'Squeeze_13:0' shape=(?,) dtype=float32>, <tf.Tensor 'Squeeze_14:0' shape=(?,) dtype=float32>, <tf.Tensor 'Squeeze_15:0' shape=(?,) dtype=float32>, <tf.Tensor 'Squeeze_16:0' shape=(?,) dtype=float32>, <tf.Tensor 'Squeeze_17:0' shape=(?,) dtype=float32>, <tf.Tensor 'Squeeze_18:0' shape=(?,) dtype=float32>, <tf.Tensor 'Squeeze_19:0' shape=(?,) dtype=float32>]
reshaped_train_labels: Tensor("transpose_2:0", shape=(?, 10), dtype=float32)
mse_loss on task  'watchtime'
identity on task  'click'
identity on task  'watchtime'
train_output_sum: Tensor("add_2:0", shape=(?, 10), dtype=float32)
train_labelss: [<tf.Tensor 'label0:0' shape=(?, 2) dtype=float32>, <tf.Tensor 'label1:0' shape=(?, 2) dtype=float32>, <tf.Tensor 'label2:0' shape=(?, 2) dtype=float32>, <tf.Tensor 'label3:0' shape=(?, 2) dtype=float32>, <tf.Tensor 'label4:0' shape=(?, 2) dtype=float32>, <tf.Tensor 'label5:0' shape=(?, 2) dtype=float32>, <tf.Tensor 'label6:0' shape=(?, 2) dtype=float32>, <tf.Tensor 'label7:0' shape=(?, 2) dtype=float32>, <tf.Tensor 'label8:0' shape=(?, 2) dtype=float32>, <tf.Tensor 'label9:0' shape=(?, 2) dtype=float32>]
reshaped_train_labels_sum: Tensor("transpose_3:0", shape=(?, 10), dtype=float32)
Created model with fresh parameters.
Create simluated clicks feed

Create direct label feed with list size 908 with feature size 136
global step 50 learning rate 0.0500 step-time 0.24 loss 47.7742
  valid: mrr_3:0.742 mrr_5:0.742 mrr_10:0.742 ndcg_3:0.259 ndcg_5:0.275 ndcg_10:0.306
Save model, valid ndcg_10:0.306
global step 100 learning rate 0.0500 step-time 0.19 loss 18.2351
  valid: mrr_3:0.771 mrr_5:0.771 mrr_10:0.771 ndcg_3:0.282 ndcg_5:0.295 ndcg_10:0.326
Save model, valid ndcg_10:0.326
global step 150 learning rate 0.0500 step-time 0.20 loss 17.7844
  valid: mrr_3:0.728 mrr_5:0.728 mrr_10:0.728 ndcg_3:0.269 ndcg_5:0.284 ndcg_10:0.318
global step 200 learning rate 0.0500 step-time 0.20 loss 17.4993
  valid: mrr_3:0.718 mrr_5:0.718 mrr_10:0.718 ndcg_3:0.276 ndcg_5:0.290 ndcg_10:0.325
global step 250 learning rate 0.0500 step-time 0.25 loss 17.4569
  valid: mrr_3:0.697 mrr_5:0.697 mrr_10:0.697 ndcg_3:0.266 ndcg_5:0.284 ndcg_10:0.318
global step 300 learning rate 0.0500 step-time 0.21 loss 17.1533
  valid: mrr_3:0.683 mrr_5:0.683 mrr_10:0.683 ndcg_3:0.260 ndcg_5:0.277 ndcg_10:0.312
global step 350 learning rate 0.0500 step-time 0.22 loss 17.2663
  valid: mrr_3:0.670 mrr_5:0.670 mrr_10:0.670 ndcg_3:0.253 ndcg_5:0.272 ndcg_10:0.305
global step 400 learning rate 0.0500 step-time 0.22 loss 17.3170
  valid: mrr_3:0.670 mrr_5:0.670 mrr_10:0.670 ndcg_3:0.258 ndcg_5:0.275 ndcg_10:0.309
global step 450 learning rate 0.0500 step-time 0.21 loss 17.2852
  valid: mrr_3:0.697 mrr_5:0.697 mrr_10:0.697 ndcg_3:0.278 ndcg_5:0.291 ndcg_10:0.321
global step 500 learning rate 0.0500 step-time 0.29 loss 17.2782
  valid: mrr_3:0.709 mrr_5:0.709 mrr_10:0.709 ndcg_3:0.285 ndcg_5:0.298 ndcg_10:0.329
Save model, valid ndcg_10:0.329
global step 550 learning rate 0.0500 step-time 0.29 loss 17.3078
  valid: mrr_3:0.698 mrr_5:0.698 mrr_10:0.698 ndcg_3:0.278 ndcg_5:0.288 ndcg_10:0.317
global step 600 learning rate 0.0500 step-time 0.29 loss 17.0538
  valid: mrr_3:0.725 mrr_5:0.725 mrr_10:0.725 ndcg_3:0.293 ndcg_5:0.303 ndcg_10:0.332
Save model, valid ndcg_10:0.332
2021-07-09 20:53:35.013551: W tensorflow/core/framework/op_kernel.cc:1651] OP_REQUIRES failed at cwise_ops_common.cc:82 : Resource exhausted: OOM when allocating tensor with shape[232448,512] and type float on /job:localhost/replica:0/task:0/device:CPU:0 by allocator cpu
Fatal Python error: Segmentation fault

Thread 0x00007f5593eff700 (most recent call first):
  File "/usr/lib64/python3.6/threading.py", line 295 in wait
  File "/usr/lib64/python3.6/queue.py", line 164 in get
  File "/usr/local/lib64/python3.6/site-packages/tensorflow_core/python/summary/writer/event_file_writer.py", line 159 in run
  File "/usr/lib64/python3.6/threading.py", line 916 in _bootstrap_inner
  File "/usr/lib64/python3.6/threading.py", line 884 in _bootstrap

Thread 0x00007f55a8eba700 (most recent call first):
  File "/usr/lib64/python3.6/threading.py", line 295 in wait
  File "/usr/lib64/python3.6/queue.py", line 164 in get
  File "/usr/local/lib64/python3.6/site-packages/tensorflow_core/python/summary/writer/event_file_writer.py", line 159 in run
  File "/usr/lib64/python3.6/threading.py", line 916 in _bootstrap_inner
  File "/usr/lib64/python3.6/threading.py", line 884 in _bootstrap

Thread 0x00007f57346bc740 (most recent call first):
  File "/usr/local/lib64/python3.6/site-packages/tensorflow_core/python/client/session.py", line 1443 in _call_tf_sessionrun
  File "/usr/local/lib64/python3.6/site-packages/tensorflow_core/python/client/session.py", line 1350 in _run_fn
  File "/usr/local/lib64/python3.6/site-packages/tensorflow_core/python/client/session.py", line 1365 in _do_call
  File "/usr/local/lib64/python3.6/site-packages/tensorflow_core/python/client/session.py", line 1359 in _do_run
  File "/usr/local/lib64/python3.6/site-packages/tensorflow_core/python/client/session.py", line 1180 in _run
  File "/usr/local/lib64/python3.6/site-packages/tensorflow_core/python/client/session.py", line 956 in run
  File "/data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py", line 260 in step
  File "main.py", line 160 in validate_model
  File "main.py", line 167 in train
  File "main.py", line 341 in main
  File "/usr/local/lib/python3.6/site-packages/absl/app.py", line 251 in _run_main
  File "/usr/local/lib/python3.6/site-packages/absl/app.py", line 303 in run
  File "/usr/local/lib64/python3.6/site-packages/tensorflow_core/python/platform/app.py", line 40 in run
  File "main.py", line 344 in <module>
offline_exp_pipeline_mtl_biastower_sep.sh: line 82: 18760 Segmentation fault      python3 main.py --max_train_iteration=2000 $SETTING_ARGS
WARNING:tensorflow:From main.py:344: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

WARNING:tensorflow:From main.py:279: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

W0709 20:53:43.603780 139788351104832 module_wrapper.py:139] From main.py:279: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

WARNING:tensorflow:From main.py:281: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

W0709 20:53:43.604034 139788351104832 module_wrapper.py:139] From main.py:281: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2021-07-09 20:53:43.604607: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA
2021-07-09 20:53:43.609579: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2494140000 Hz
2021-07-09 20:53:43.609996: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x51cca20 initialized for platform Host (this does not guarantee that XLA will be used). Devices:
2021-07-09 20:53:43.610022: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (0): Host, Default Version
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py:56: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0709 20:54:43.193580 139788351104832 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py:56: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:124: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0709 20:54:43.888215 139788351104832 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:124: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/MTLBiasTowerDNN.py:69: The name tf.get_variable_scope is deprecated. Please use tf.compat.v1.get_variable_scope instead.

W0709 20:54:45.133530 139788351104832 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/MTLBiasTowerDNN.py:69: The name tf.get_variable_scope is deprecated. Please use tf.compat.v1.get_variable_scope instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/MTLBiasTowerDNN.py:70: The name tf.AUTO_REUSE is deprecated. Please use tf.compat.v1.AUTO_REUSE instead.

W0709 20:54:45.133780 139788351104832 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/MTLBiasTowerDNN.py:70: The name tf.AUTO_REUSE is deprecated. Please use tf.compat.v1.AUTO_REUSE instead.

WARNING:tensorflow:From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/ops/resource_variable_ops.py:1630: calling BaseResourceVariable.__init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
W0709 20:54:45.167083 139788351104832 deprecation.py:506] From /usr/local/lib64/python3.6/site-packages/tensorflow_core/python/ops/resource_variable_ops.py:1630: calling BaseResourceVariable.__init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/base_ranking_model.py:121: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0709 20:54:45.180830 139788351104832 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/ranking_model/base_ranking_model.py:121: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:85: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0709 20:54:47.028318 139788351104832 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/base_algorithm.py:85: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:278: to_float (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0709 20:54:51.072849 139788351104832 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:278: to_float (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py:100: The name tf.summary.scalar is deprecated. Please use tf.compat.v1.summary.scalar instead.

W0709 20:54:51.099071 139788351104832 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py:100: The name tf.summary.scalar is deprecated. Please use tf.compat.v1.summary.scalar instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:172: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0709 20:54:51.967593 139788351104832 deprecation.py:323] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/metrics.py:172: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py:228: The name tf.summary.merge_all is deprecated. Please use tf.compat.v1.summary.merge_all instead.

W0709 20:54:52.426522 139788351104832 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py:228: The name tf.summary.merge_all is deprecated. Please use tf.compat.v1.summary.merge_all instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py:230: The name tf.train.Saver is deprecated. Please use tf.compat.v1.train.Saver instead.

W0709 20:54:52.427533 139788351104832 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py:230: The name tf.train.Saver is deprecated. Please use tf.compat.v1.train.Saver instead.

WARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py:230: The name tf.global_variables is deprecated. Please use tf.compat.v1.global_variables instead.

W0709 20:54:52.427710 139788351104832 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/learning_algorithm/navie_mtl_algorithm.py:230: The name tf.global_variables is deprecated. Please use tf.compat.v1.global_variables instead.

INFO:tensorflow:Restoring parameters from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_model_mtl_biastower_sep_identity/ultra.learning_algorithm.NavieMTLAlgorithm.ckpt-600
I0709 20:54:52.484589 139788351104832 saver.py:1284] Restoring parameters from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_model_mtl_biastower_sep_identity/ultra.learning_algorithm.NavieMTLAlgorithm.ckpt-600
WARNING:tensorflow:From main.py:296: The name tf.summary.FileWriter is deprecated. Please use tf.compat.v1.summary.FileWriter instead.

W0709 20:54:53.212918 139788351104832 module_wrapper.py:139] From main.py:296: The name tf.summary.FileWriter is deprecated. Please use tf.compat.v1.summary.FileWriter instead.

Reading data in /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_data/
Read data from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_data//test in ULTRA format.
Feature reading finish.
List reading finish.
Label reading finish.
Remove 1 invalid queries.
Data reading finish!
Finished reading 1927 queries with lists.
Build NavieAlgorithm
hparams: tasks=['click', 'watchtime']
ranking_model: <class 'ultra.ranking_model.MTLBiasTowerDNN.MTLBiasTowerDNN'>
in bias tower dnn.. hparams: [('activation_func', 'elu'), ('bias_hidden_layer_sizes', [128, 64]), ('combine_mode', 'sum'), ('hidden_layer_sizes', [512, 256, 128]), ('initializer', 'glorot'), ('norm', 'layer'), ('output_act', 'indentity'), ('position_embsize', 24), ('tasks', ['click', 'watchtime'])]
kwargs: {'rank_list_size': 514, 'forward_only': True}
input_data shape: [None, 136]
in bias tower.. forward_only: True
in bias tower.. rank_list_size: 514
res: [<tf.Tensor 'concat:0' shape=(?, 514) dtype=float32>, <tf.Tensor 'concat_1:0' shape=(?, 514) dtype=float32>]
loss func: sigmoid_cross_entropy
output_act: identity
identity on task  'click'
loss func: mse_loss
output_act: identity
identity on task  'watchtime'
reshaped_labels: Tensor("transpose:0", shape=(?, 514), dtype=float32)
Reading model parameters from /data/violatang/l2r-paper/data/MSLR_10k_letor/tmp_model_mtl_biastower_sep_identity/ultra.learning_algorithm.NavieMTLAlgorithm.ckpt-600
Create direct label feed with list size 514 with feature size 136
Testing 13% finishedTesting 27% finishedTesting 40% finishedTesting 53% finishedTesting 66% finishedTesting 80% finishedTesting 93% finishedTesting 100% finishedWARNING:tensorflow:From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/data_utils.py:367: The name tf.Summary is deprecated. Please use tf.compat.v1.Summary instead.

W0709 20:55:26.322367 139788351104832 module_wrapper.py:139] From /data/violatang/l2r-paper/code/ULTRA/ultra/utils/data_utils.py:367: The name tf.Summary is deprecated. Please use tf.compat.v1.Summary instead.


[Done]
  eval: mrr_3:0.718 mrr_5:0.718 mrr_10:0.718 ndcg_3:0.292 ndcg_5:0.306 ndcg_10:0.333
